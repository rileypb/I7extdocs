<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Extension</title>
    <style type="text/css">
        <!--
        :root {
            color-scheme: light dark;
            --element-banner-background-colour: #eeeeee;
            --heading-panel-background-colour: #eeeeee;
            --heading-panel-text-colour: #222222;
            --heading-panel-succeeded-background-colour: #E6FFE6;
            --heading-panel-failed-background-colour: #f69Ca6;

            --heading-row-background-colour: #e0e0e0;
            --stripe-one-background-colour: #ffffff;
            --stripe-two-background-colour: #f3f6fa;

            --index-dull-red-colour: #800000;
            --periodic-table-sidebar-colour: #888;
            --periodic-table-sidebar-hover-colour: #222;
            --leaders-background-colour: white;
            --library-card-title-colour: #803030;
            --library-card-other-colour: #303030;
            --index-more-box-background-colour: #e0e0e0;
            --index-activity-contents-background-colour: #e8e0c0;
            --registry-contents-link-colour: #202020;

        }

        @media (prefers-color-scheme: dark) {
          :root {
            --element-banner-background-colour: #444444;
            --heading-panel-background-colour: #444444;
            --heading-panel-text-colour: #ffffff;
            --heading-panel-succeeded-background-colour: #738073;
            --heading-panel-failed-background-colour: #7b4e53;

            --heading-row-background-colour: #707070;
            --stripe-one-background-colour: #7f7f7f;
            --stripe-two-background-colour: #797b7d;

            --index-dull-red-colour: #c00000;
            --periodic-table-sidebar-colour: #555;
            --periodic-table-sidebar-hover-colour: #222;
            --leaders-background-colour: black;
            --library-card-title-colour: #a05050;
            --library-card-other-colour: #505050;
            --index-more-box-background-colour: #444444;
            --index-activity-contents-background-colour: #727060;
            --registry-contents-link-colour: #ffffff;
            }
        }

        /* The default font (family) and size */

        body, p, td {
            font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
            -webkit-font-smoothing: antialiased;
            font-size: 12px;
        }

        /* For fixed-point material within text, such as the typing on the Library Card index page */

        span.typewritten {
            font-family: 'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace;
            font-size: 13px;
        }

        /* For less important material: the small print */

        span.smaller {
            font-size: 80%;
        }

        /* The "heading panel" is the coloured box, high up on the page. The colours
        vary depending on the page: for example, the style on a report of a translation
        with no problems is "headingpanelsucceeded", usually green, but if there were
        problems then "headingpanelfailed" is used, which is usually red. "headingpanel"
        itself is a more neutral grey by default. "headingpanelDark" is an alternative
        look to make the extensions index pages have some visual contrast with the others;
        by default they are a darker grey. */

        .headingpanel {
            background: var(--heading-panel-background-colour);
        }
        .headingpanelsucceeded {
            background: var(--heading-panel-succeeded-background-colour);
        }
        .headingpanelfailed {
            background: var(--heading-panel-failed-background-colour);
        }
        .headingpanelalt {
            background: #808080;
        }

        /* Heading panels have two lines of text: an upper one in a larger size, and a
        lower one in a smaller. Again, the alt versions are meant to contrast.

            Report on Translation: Succeeded                <-- headingpaneltext
            Produced by Inform 10.1.0 (build 6U97)          <-- headingpanelrubric

            Installed Extensions                            <-- headingpaneltextalt
            Bundles of extra rules or phrases to...         <-- headingpanelrubricalt

        */

        span.headingpaneltext {
            color: var(--heading-panel-text-colour);
            font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
            -webkit-font-smoothing: antialiased;
            font-size: 20px;
            font-weight: bold;
        }
        span.headingpaneltextalt {
            color: #ffffff;
            font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
            -webkit-font-smoothing: antialiased;
            font-size: 20px;
            font-weight: bold;
        }

        span.headingpanelrubric {
            color: var(--heading-panel-text-colour);
            font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
            -webkit-font-smoothing: antialiased;
            font-size: 11px;
            font-weight: bold;
        }
        span.headingpanelrubricalt {
            color: #ffffff;
            font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
            -webkit-font-smoothing: antialiased;
            font-size: 11px;
            font-weight: bold;
        }

        /* Horizontal rule styling */

        div.hr {
            border: 0;
            width: 100%;
            color: #707070;
            background-color: #707070;
            height: 5px;
        }

        /* This styles the (usually white) text of the example numbers written inside
        oval blobs in the extension documentation, which mimic the look of the in-app
        documentation. */

        .oval, .oval td {
            background-image:url('../../../doc_images/ovoid.png');
            color:white;
        }

        /* Styling used in the extension documentation indexes: */

        /* Used for extension names in the extensions pane of the app */

        span.extensioncensusentry {
            color: #ffffff;
        }

        span.extensionindexentry {
            color: #404040;
        }

        span.extensionindexerror {
            color: #ff8080;
        }

        /* This is used in extension documentation, where an example is presented
        in a slightly tinted box: */

        table.extensionexample {
        	background-color: #f0f0f0;
        }

        span.extensionexampleletter {
        	color: #202020;
        	font-size: 14px;
        	font-weight: bold;
        }

        /* Seen in problem messages: */

        span.problemred {
            color: #800000;
        }

        span.problemgreen {
            color: #008000;
        }

        span.phraseword {
            color: #808080;
        }

        span.phrasetokentext {
            color: #e00060;
        }

        span.phrasetokendesctext {
            color: #4040ff;
        }

        span.phrasetokenvaluetext {
            color: #ff4040;
        }

        /* Now we move on to styling used in the Index pages only: */

        /* The periodic table display has "sidebars", usually grey and taller than they
        are wide; they contain no text. */

        div.periodictablesidebarcolour {
            background: var(--periodic-table-sidebar-colour);
        }
        div.periodictablesidebar:hover {
            background: var(--periodic-table-sidebar-hover-colour);
        }

        /* The text of the element-abbreviation, such as "Lx" or "Ph", uses: */

        span.elementtext {
            color: #ffffff;
            font-size: 20px;
            font-weight: bold;
        }

        /* Similarly for the "atomic number" - a single digit - in the top left corner
        of these boxes: */

        span.elementnumbertext {
            color: #ffffff;
            font-size: 7pt;
        }

        /* For the text of the element title, to the right of the element box: */

        span.elementtitletext {
            color: #ffffff;
            font-size: 9px;
            font-weight: bold;
        }

        /* The banner at the top of each element: */

        table.elementbanner {
            background: var(--element-banner-background-colour);
        }

        /* For the typewriting on the Library Card: */

        span.librarycardtitle {
            color: var(--library-card-title-colour);
        }

        span.librarycardother {
            color: var(--library-card-other-colour);
        }

        /* Generically used for "more details" boxes in the index: */

        table.indexmorebox {
        	background-color: var(--index-more-box-background-colour);
            border-radius: 8px;
        }

        /* But not for activity contents: */

        table.indexactivitycontents {
        	background-color: var(--index-activity-contents-background-colour);
            border-radius: 8px;
        }

        /* For responses in index entries about rules: */

        span.indexresponseletter {
            color: #ffffff;
            font-family: 'Courier New', Courier, monospace;
            background-color: #8080ff;
        }

        span.indexresponsetext {
            color: #000066;
        }

        /* Used ubiquitously throughout the index for unemphasised text: */

        span.indexblack {
        	color: #000000;
        }

        span.indexgrey {
        	color: #808080;
        }

        span.indexdarkgrey {
            color: #505050;
        }

        span.indexdullred {
            color: var(--index-dull-red-colour);
        }

        span.indexdullgreen {
            color: #008000;
        }

        span.indexdullblue {
            color: #000080;
        }

        /* Used in the numbering of levels of the World map in the Index */

        span.indexmaplevelnumbers {
        	color: #c0c0c0;
        }

        /* Used for the room squares in the World map in the Index (which is currently
        a table with one row of one column) */

        table.indexmaproom {
        	border-color: #000000;
        }

        /* Used in the numbering of levels of the World map in the Index */

        span.indexmaplevelnumbers {
        	color: #c0c0c0;
        }

        /* Used e.g. for title rows in the Chart of basic kinds in the Index */

        tr.headingrow {
        	background-color: var(--heading-row-background-colour);
        }

        /* Standard rows have black text on striped background colours, these being
        the usual ones seen in Mac OS X applications such as iTunes. */

        tr.stripeone {
        	background-color: var(--stripe-one-background-colour);
        }

        tr.stripetwo {
        	background-color: var(--stripe-two-background-colour);
        }

        tr.tintedrow {
        	background-color: #808080;
        }

        /* In the Figures index, this is the background colour used behind images
        (though in fact it will only be visible if the image fails to load, or uses
        transparency): */

        div.figureindexbox {
        	background-color: #6495ed;
        }

        /* To get the book-contents-page style leaders on the Contents element of
           the index to work, these must use the background colour of the body of
           the page, whatever that is: */

        ul.leaders li.leaded span:first-child {
            background: var(--leaders-background-colour);
        }
        ul.leaders li.leaded span + span {
            background: var(--leaders-background-colour);
        }

        /* On Registry index pages (such as the Public Library), these are used for
        download buttons and the like: */

        span.registrybuttontext {
        	font-size: 11px;
        	border-color: #000000;
        }

        span.registryminibuttontext {
        	font-size: 10px;
        	border-color: #000000;
        }

        span.registrybuttonuninstalled {
        	color: #000000;
        	background: #ffffdd;
        }

        span.registrybuttoninstalled {
        	color: #000000;
        	background: #ffffff;
        	pointer-events: none;
        }

        span.registrybuttonbuiltin {
        	color: #888888;
        	background: #ffffff;
        	pointer-events: none;
        }

        span.registrybuttonupdate {
        	color: #000000;
        	background: #aaddff;
        }

        span.registrybuttonrevert {
        	color: #000000;
        	background: #ddaaff;
        }

        span.registrybuttonrevealer {
        	color: #ffffff;
        	background: #444444;
        }

        /* Registry index section headings: */

        span.registrysectionname {
        	font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
        	-webkit-font-smoothing: antialiased;
        	font-size: 16px;
        	line-height: 18px;
        }
        span.registrysubsectionname {
        	font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
        	-webkit-font-smoothing: antialiased;
        	font-size: 14px;
        	line-height: 16px;
        }

        /* These are for the "mark" for a section, usually a section-symbol and number */

        span.registrysectionmark {
        	font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
        	-webkit-font-smoothing: antialiased;
        	font-size: 16px;
        	line-height: 18px;
        	color: #666;
        }
        span.registrysubsectionmark {
        	font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
        	-webkit-font-smoothing: antialiased;
        	font-size: 14px;
        	line-height: 16px;
        	color: #666;
        }

        /* Text of an item listed in a registry: */

        span.registryitemtext {
        	font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
        	-webkit-font-smoothing: antialiased;
        	font-size: 12px;
        	line-height: 16px;
        }

        /* And how the links in a registry index page behave: */

        a.registrysilentlink {
        	text-decoration: none;
        	color: #000;
        }
        a.registrybuttonlink {
        	text-decoration: none;
        }
        a.registrycontentslink:link {
        	text-decoration: none;
        	color: var(--registry-contents-link-colour);
        }
        a.registrycontentslink:visited {
        	text-decoration: none;
        	color: var(--registry-contents-link-colour);
        }
        a.registrycontentslink:hover {
        	text-decoration: none;
        	color: #D00000;
        }
        a.registrycontentslink:active {
        	text-decoration: none;
        	color: #D00000;
        }

        -->
    </style>
    <style type="text/css">
        <!--
        /* (1) General layout material */

        *, *:before, *:after {
        	-moz-box-sizing: border-box;
        	-webkit-box-sizing: border-box;
        	box-sizing: border-box;
        }
        .headingpanellayout {
        	position: relative;
        	height: 56px;
        	padding: 0px;
        	white-space:nowrap;
        }
        .headingpanellayoutdeeper {
        	position: relative;
        	height: 117px;
        	padding: 0px;
        	white-space:nowrap;
        }
        .headingtext {
        	position: absolute;
        	top: -4px;
        	left: -1px;
        	width: 100%;
        	padding: 14px 10px 0px 10px;
        }
        .headingrubric {
        	position: absolute;
        	top: 36px;
        	width: 100%;
        	padding: 0px 10px 0px 10px;
        }
        h3.tighter {
        	margin-top: 0px;
        }
        p.hang {
        	padding-left: 25px;
        	text-indent: -25px;
        	margin-top: 0px;
        	margin-bottom: 0px;
        }
        p.in1 {
        	padding-left: 0px;
        }
        p.tightin1 {
        	padding-left: 0px;
        	margin-top: 2px;
        	margin-bottom: 2px;
        }
        p.halftightin1 {
        	padding-left: 0px;
        	margin-bottom: 2px;
        }
        p.hangingin1 {
        	padding-left: 50px;
        	text-indent: -50px;
        	margin-top: 0px;
        	margin-bottom: 1px;
        }
        p.in2 {
        	padding-left: 25px;
        }
        p.tightin2 {
        	padding-left: 25px;
        	margin-top: 2px;
        	margin-bottom: 2px;
        }
        p.halftightin2 {
        	padding-left: 25px;
        	margin-bottom: 2px;
        }
        p.hangingin2 {
        	padding-left: 75px;
        	text-indent: -50px;
        	margin-top: 0px;
        	margin-bottom: 1px;
        }
        p.in3 {
        	padding-left: 50px;
        }
        p.tightin3 {
        	padding-left: 50px;
        	margin-top: 2px;
        	margin-bottom: 2px;
        }
        p.halftightin3 {
        	padding-left: 50px;
        	margin-bottom: 2px;
        }
        p.hangingin3 {
        	padding-left: 100px;
        	text-indent: -50px;
        	margin-top: 0px;
        	margin-bottom: 1px;
        }
        p.in4 {
        	padding-left: 75px;
        }
        p.tightin4 {
        	padding-left: 75px;
        	margin-top: 2px;
        	margin-bottom: 2px;
        }
        p.halftightin4 {
        	padding-left: 75px;
        	margin-bottom: 2px;
        }
        p.hangingin4 {
        	padding-left: 125px;
        	text-indent: -50px;
        	margin-top: 0px;
        	margin-bottom: 1px;
        }
        p.in5 {
        	padding-left: 100px;
        }
        p.tightin5 {
        	padding-left: 100px;
        	margin-top: 2px;
        	margin-bottom: 2px;
        }
        p.halftightin5 {
        	padding-left: 100px;
        	margin-bottom: 2px;
        }
        p.hangingin5 {
        	padding-left: 150px;
        	text-indent: -50px;
        	margin-top: 0px;
        	margin-bottom: 1px;
        }
        p.in6 {
        	padding-left: 125px;
        }
        p.tightin6 {
        	padding-left: 125px;
        	margin-top: 2px;
        	margin-bottom: 2px;
        }
        p.halftightin6 {
        	padding-left: 125px;
        	margin-bottom: 2px;
        }
        p.hangingin6 {
        	padding-left: 175px;
        	text-indent: -50px;
        	margin-top: 0px;
        	margin-bottom: 1px;
        }
        p.in7 {
        	padding-left: 150px;
        }
        p.tightin7 {
        	padding-left: 150px;
        	margin-top: 2px;
        	margin-bottom: 2px;
        }
        p.halftightin7 {
        	padding-left: 150px;
        	margin-bottom: 2px;
        }
        p.hangingin7 {
        	padding-left: 200px;
        	text-indent: -50px;
        	margin-top: 0px;
        	margin-bottom: 1px;
        }
        p.in8 {
        	padding-left: 175px;
        }
        p.tightin8 {
        	padding-left: 175px;
        	margin-top: 2px;
        	margin-bottom: 2px;
        }
        p.halftightin8 {
        	padding-left: 175px;
        	margin-bottom: 2px;
        }
        p.hangingin8 {
        	padding-left: 225px;
        	text-indent: -50px;
        	margin-top: 0px;
        	margin-bottom: 1px;
        }
        p.in9 {
        	padding-left: 200px;
        }
        p.tightin9 {
        	padding-left: 200px;
        	margin-top: 2px;
        	margin-bottom: 2px;
        }
        p.halftightin9 {
        	padding-left: 200px;
        	margin-bottom: 2px;
        }
        p.hangingin9 {
        	padding-left: 250px;
        	text-indent: -50px;
        	margin-top: 0px;
        	margin-bottom: 1px;
        }

        /* (2) Index page layout material */

        /* The periodic table display has "sidebars", usually grey and taller than they
        are wide; they contain no text. */

        div.periodictablesidebar {
        	height: 56px;
        	width: 16px;
        }
        .periodictablesidebar a:link { text-decoration: none; }
        .periodictablesidebar a:visited { text-decoration: none; }
        .periodictablesidebar a:active { text-decoration: none; }

        /* The "element boxes" are the cells appearing in the periodic-table display
        on the welcome page of the index: */

        .elementbox {
        	position: relative;
        	height: 56px;
        	width: 56px;
        	padding: 0px;
        }

        .elementbox a:link { text-decoration: none; }
        .elementbox a:visited { text-decoration: none; }
        .elementbox a:active { text-decoration: none; }
        .elementbox a:hover { text-decoration: none; }
        .elementbox:hover {
        	opacity: 0.6;
        }

        /* The "small element boxes" look like those, but are smaller, and used on
        the headings of the content which those original boxes link to: */

        .smallelementbox {
        	position: relative;
        	height: 40px;
        	width: 40px;
        	padding: 0px;
        }

        .smallelementbox a:link { text-decoration: none; }
        .smallelementbox a:visited { text-decoration: none; }
        .smallelementbox a:active { text-decoration: none; }
        .smallelementbox a:hover { text-decoration: none; }
        .smallelementbox:hover {
        	opacity: 0.6;
        }

        /* This is a class for the links formed by the element boxes: */

        a.elementlink {
        	position: absolute;
        	top: -4px;
        	left: -1px;
        	width: 100%;
        	padding: 14px 0px 14px 1px;
        	text-align: center;
        }

        /* Similarly for the "atomic number" - a single digit - in the top left corner
        of these boxes: */

        div.elementnumber {
        	position: absolute;
        	top: 1px;
        	left: 3px;
        	text-align: left;
        }

        /* For the text of the element title, to the right of the element box: */

        div.elementtitle {
        	position: absolute;
        	top: 35px;
        	width: 100%;
        	text-align: center;
        }

        /* Used for the book-contents-page style leaders on the Contents element of
           the index: */

        ul.leaders {
        	padding: 0;
        	margin-top: 1px;
        	margin-bottom: 0;
        	overflow-x: hidden;
        	list-style: none}
        ul.leaders li.leaded:before {
        	float: left;
        	width: 0;
        	white-space: nowrap;
        	content:
        	".  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  "
        	".  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  "
        	".  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  "
        	".  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  "
        	".  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  "
        	".  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  "
        	".  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  "
        	".  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  "
        	".  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  "
        	".  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  "}
        ul.leaders li.leaded span:first-child {
        	padding-right: 0.33em;
        }
        ul.leaders li.leaded span + span {
        	float: right;
        	padding-left: 0.33em;
        }
        li.indent1 span:first-child {
        	padding-left: 25px;
        }
        li.indent2 span:first-child {
        	padding-left: 50px;
        }
        li.indent3 span:first-child {
        	padding-left: 75px;
        }
        li.indent4 span:first-child {
        	padding-left: 100px;
        }
        li.indent5 span:first-child {
        	padding-left: 125px;
        }
        li.indent6 span:first-child {
        	padding-left: 150px;
        }
        li.indent7 span:first-child {
        	padding-left: 175px;
        }
        li.indent8 span:first-child {
        	padding-left: 200px;
        }
        li.indent9 span:first-child {
        	padding-left: 225px;
        }

        li.unleaded:before {
        	content: "";
        }

        /* On Registry index pages (such as the Public Library), these are used for
        download buttons and the like: */

        span.registrybuttons {
        	height: 20px;
        	padding: 2px 8px 2px 8px;
        	margin: 2px;
        	border:1px solid;
        	border-radius: 5px;
        }

        span.registryminibuttons {
        	height: 14px;
        	padding: 2px 5px 2px 5px;
        	margin: 2px;
        	border:1px solid;
        	border-radius: 4px;
        }

        /* Used to hide or display sections in the Registry pages: */

        div.registrysectionitemsopen {
        	display: block;
        }

        div.registrysectionitemsclosed {
        	display: none;
        }

        /* Hanging indentation for Registry item paragraphs: */

        p.registryitem {
        	padding-left: 80px;
        	text-indent: -40px;
        }

        p.registryaddition {
        	padding-left: 40px;
        	text-indent: -40px;
        }

        -->
    </style>
    <script type="text/javascript">
        function project() {
            return window.Project;
        }
        function showExtra(id, imid) {
        	if (document.getElementById(id).style.display == 'block') {
        		document.getElementById(id).style.display = 'none';
        		document.getElementById(imid).src = 'inform:/extra.png';
        	} else {
        		document.getElementById(id).style.display = 'block';
        		document.getElementById(imid).src = 'inform:/extraclose.png';
        	}
        }
        function openExtra(id, imid) {
        	document.getElementById(id).style.display = 'block';
        	document.getElementById(imid).src = 'inform:/extraclose.png';
        }
        function closeExtra(id, imid) {
        	document.getElementById(id).style.display = 'none';
        	document.getElementById(imid).src = 'inform:/extra.png';
        }
        function pasteCode(code) {
            var myProject = project();

            myProject.selectView('source');
            myProject.pasteCode(code);
        }

    </script>
</head>
<body>
    <!--CONTENT BEGINS-->
    <table CELLPADDING=0 CELLSPACING=0 width="100%" bgcolor="#000000"><tr><TD width=38px height=26px align="center" valign="center"><img border=0 src="../../../doc_images/Hookindex.png" border=0></td><TD width=38px height=26px align="center" valign="center"></td><td halign="left" valign="center" CELLPADDING=0 CELLSPACING=0></td><TD width=56px height=26px align="right" valign="center"><img border=0 src="../../../doc_images/Hookup.png" border=0></td></tr></table>

    <p><img border=0 src=../../../doc_images/paste.png>&nbsp;<b>Undo Output Control<span class="extensionindexentry"> by </span>Erik Temple</b></p>
    <p><span class="smaller">Version 5.0.170902</span></p>
    <p>In addition to allowing control over UNDO default messages, provides hooks into UNDO processing, including multiple ways to suspend UNDO temporarily, to place limitations on UNDO (such as allowing only one UNDO in a row), to undo the current turn from code, and to control when the game state is saved. Using the latter, we can effectively control which turn UNDO returns us to.  Also allows changing the words which invoke UNDO and OOPS.  Also allows the story to edit a blank command before analyzing it.  Updated to Inform 6M62.</p>
    <p></p>
    <hr>
    <p><span class="indexblack"><a style="text-decoration: none" href=#docsec1>Section 1: </span>Output rules<br>
    <span class="indexblack"><a style="text-decoration: none" href=#docsec2>Section 2: </span>Undo suspension<br>
    <span class="indexblack"><a style="text-decoration: none" href=#docsec3>Section 3: </span>Removing the option to UNDO at the end of the game<br>
    <span class="indexblack"><a style="text-decoration: none" href=#docsec4>Section 4: </span>Temporary suspension of game state saving<br>
    <span class="indexblack"><a style="text-decoration: none" href=#docsec5>Section 5: </span>Changing vocabulary for UNDO and OOPS<br>
    <span class="indexblack"><a style="text-decoration: none" href=#docsec6>Section 6: </span>Undoing the current turn<br>
    <span class="indexblack"><a style="text-decoration: none" href=#docsec7>Section 7: </span>Repairing an empty command<br>
    <span class="indexblack"><a style="text-decoration: none" href=#docsec8>Section 8: </span>Using this extension with Conditional Undo by Jesse McGrew<br>
    <span class="indexblack"><a style="text-decoration: none" href=#docsec9>Section 9: </span>Using this extension with Unified Glulx Input by Andrew Plotkin<br>
    <span class="indexblack"><a style="text-decoration: none" href=#docsec10>Section 10: </span>Change log<br>
    <br>
    <b>Examples</b><br>
    &nbsp;&nbsp;&nbsp;<span class="indexblack"><a style="text-decoration: none" href="Undo Output Control-eg1.html#eg1">A &mdash; Mynah Undo</span><br>
    &nbsp;&nbsp;&nbsp;<span class="indexblack"><a style="text-decoration: none" href="Undo Output Control-eg2.html#eg2">B &mdash; I Love the Sound of Breaking Glass</span><br>
    &nbsp;&nbsp;&nbsp;<span class="indexblack"><a style="text-decoration: none" href="Undo Output Control-eg3.html#eg3">C &mdash; Purgatory</span><br>
    &nbsp;&nbsp;&nbsp;<span class="indexblack"><a style="text-decoration: none" href="Undo Output Control-eg4.html#eg4">D &mdash; Purgatory II</span><br>
    </p>
    <hr>
    <p></p>
    </p>

    <p> Undo Output Control patches the I6 template routines Keyboard (); and Perform_Undo (); so that we can use I7 rulebooks to hook into the UNDO command. These allow us to do anything we like--write new messages for UNDO responses and error text, keep track of variables (partially) independently of the game state as restored by UNDO, and even suspend UNDO programmatically.</p>

    <p> Undo Output Control is compatible with Conditional Undo by Jesse McGrew, which provides a more flexible framework for undo prevention. Using the extension with Conditional Undo does change some aspects of usage; see below.</p>

    <p><p><span class="indexblack"><b><span id=docsec1>Section 1: Output rules</span></b></span></p>
    </p>

    <p> The basic rulebooks provided by Undo Output Control are:</p>

    <p><blockquote><span class="indexdullblue"> (1) before undoing an action rules<br>
     (2) after undoing an action rules<br>
     (3) report undoing an action rules</span></blockquote>

    <p> These rulebooks provide hooks into the following &quot;moments&quot; in the UNDO process: (1) before testing whether UNDO is allowed/possible; (2) after an action has been _successfully_ undone; and (3) after an action has been successfully undone but immediately before it is reported, optionally allowing us to replace Inform's default output with our own. The report undoing an action rules should end explicitly in either success or failure. The rulebook will end in failure by default, which means that Inform's default reporting for UNDO will be printed. If you want to substitute Inform's reporting with your own, end your report undoing an action rule with &quot;rule succeeds&quot; or equivalent (see the example for a demonstration).</p>

    <p> The same is true of the more specialized rules:</p>

    <p><blockquote><span class="indexdullblue"> report prevented undo rules<br>
     report interpreter-undo-incapacity rules<br>
     report interpreter undo failure rules<br>
     report nothing to be undone failure rules</span></blockquote>

    <p> All of these also require a rule to end explicitly with &quot;success&quot; in order to replace the default output.</p>

    <p> A number of rules are provided as &quot;before&quot; and &quot;after&quot; counterparts of these rules:</p>

    <p><blockquote><span class="indexdullblue"> before prevented undo rules<br>
     after prevented undo rules<br>
     before interpreter-undo-incapacity rules<br>
     after interpreter-undo-incapacity rules<br>
     before interpreter undo failure rules<br>
     after interpreter undo failure rules<br>
     before nothing to be undone failure rules<br>
     after nothing to be undone failure rules</span></blockquote>

    <p> The before, after, and report prevented undo rules apply only when Inform's built-in use undo prevention option is enabled.</p>

    <p> It should be emphasized that, though these rules look like standard action rulebooks, they are not. UNDO is not an action, and these rules are limited to imitating the appearance of action rules. This is why &quot;check undoing&quot; and &quot;instead of undoing&quot; rulebooks are not provided. We have hooks into the output, but little else.</p>

    <p> However, it should be noted that when the before undoing an action rulebook ends in explicit failure, undo will be prevented from occurring; this is one way (perhaps the simplest) of disabling UNDO. An example:</p>

    <p><blockquote><span class="indexdullblue"> Before undoing an action when the player is tired:<br>
    &nbsp;&nbsp;&nbsp;&nbsp; say &quot;You are too tired to bend space-time to your will.&quot;;<br>
    &nbsp;&nbsp;&nbsp;&nbsp; rule fails.</span></blockquote>

    <p> The &quot;Breaking Glass&quot; example provides examples of ways to use both the before and after undoing entry points to accomplish interesting effects.</p>

    <p><p><span class="indexblack"><b><span id=docsec2>Section 2: Undo suspension</span></b></span></p>
    </p>

    <p> Undo Output Control provides a second mechanism for suspending UNDO. To turn UNDO on and off at will, we simply use these phrases:</p>

    <p><blockquote><span class="indexdullblue"> suspend undo<br>
     reinstate undo</span></blockquote>

    <p> Note that these will not function if we have used Inform's built-in undo prevention, which functions globally.</p>

    <p> We can also test whether UNDO is disabled using the &quot;if undo is suspended&quot; condition.</p>

    <p> Finally, a rulebook is provided that allows us to control the reporting of a failed attempt to UNDO while undo is suspended:</p>

    <p><blockquote><span class="indexdullblue"> report attempt to undo-while-disabled rules</span></blockquote>

    <p> By default, these rules print the message &quot;That action cannot be undone.&quot;</p>

    <p> Be warned that if the player types UNDO immediately after you have reinstated it, there may be unexpected behavior, as the game can revert to the suspended state, but in such a way that the report attempt to undo-while-disabled rules do not fire.</p>

    <p><p><span class="indexblack"><b><span id=docsec3>Section 3: Removing the option to UNDO at the end of the game</span></b></span></p>
    </p>

    <p> Note that the &quot;before undoing an action rule&quot; is NOT consulted after the game has finished, so we will not be able to use it to block UNDO at that point. Instead, we should simply remove UNDO from the list of options that are presented at the end of the game (&quot;Would you like to RESTART, RESTORE a saved game, QUIT or UNDO the last command?&quot;). We can do so by removing it from the Table of Final Question Options, like this:</p>

    <p><blockquote><span class="indexdullblue"> When play begins:<br>
    &nbsp;&nbsp;&nbsp;&nbsp; choose row with a final response rule of immediately undo rule in the Table of Final Question Options;<br>
    &nbsp;&nbsp;&nbsp;&nbsp; delete the final question wording entry.</span></blockquote>

    <p> This can be done conditionally if needed. We just need to delete the table row before the command to end the game.</p>

    <p><p><span class="indexblack"><b><span id=docsec4>Section 4: Temporary suspension of game state saving</span></b></span></p>
    </p>

    <p> Each turn, after the player has entered a command but before the command is parsed, Inform saves the state of the game into memory. This is the saved state to which the next UNDO command will revert. We can stop the game from saving the undo state, if desired. Once we've disabled saving, an UNDO typed later will revert back to the last saved state. If there are no saved undo states available, a message will print (&quot;You cannot undo any further&quot; by default).</p>

    <p> Undo Output Control provides the following phrases for controlling undo saves:</p>

    <p><blockquote><span class="indexdullblue"> disable saving of undo state<br>
     enable saving of undo state</span></blockquote>

    <p> See the &quot;Purgatory&quot; example below for a demonstration of how this feature might be used.</p>

    <p><p><span class="indexblack"><b><span id=docsec5>Section 5: Changing vocabulary for UNDO and OOPS</span></b></span></p>
    </p>

    <p> As was mentioned above, UNDO is not an action. Along with OOPS, it is handled before the player's command is actually parsed. To decide whether the player has typed either of these commands, Inform looks at the first word--only! --of the player's input and compares it to a character string (defined as an I6 constant). Because there is no I7 type that is exactly equivalent to this I6 type, it is quite difficult for I7 writers to add to or change the vocabulary associated with these commands.</p>

    <p> Undo Output Control makes providing new vocabulary for UNDO and OOPS a bit easier. Each command has three &quot;words&quot; associated with it. These are, with their initial values:</p>

    <p><blockquote><span class="indexdullblue"> UNDO<br>
     undo word #1 &quot;undo&quot;<br>
     undo word #2 &quot;undo&quot;<br>
     undo word #3 &quot;undo&quot;</span></blockquote>

    <p><blockquote><span class="indexdullblue"> OOPS<br>
     oops word #1 &quot;oops&quot;<br>
     oops word #2 &quot;o//&quot;<br>
     oops word #3 &quot;oops&quot;</span></blockquote>

    <p> We can thus add up to two vocabulary words for each command, in addition to the standard &quot;oops&quot; and &quot;undo&quot;, or we can replace all three slots for each word if we like. Note that oops word #2 is a single-letter abbreviation; two forward slashes are required after single-letter words for Inform to understand them.</p>

    <p> To change one of these vocabulary words, we need to define a phrase. For example:</p>

    <p><blockquote><span class="indexdullblue"> To decide which value is undo word #3:<br>
    &nbsp;&nbsp;&nbsp;&nbsp; (-  'revert'  -)</span></blockquote>

    <p> The word must be placed within single quotes, and only a single word can be matched. If your text contains a space, it will never be matched.</p>

    <p> To eliminate the &quot;o&quot; synonym for oops:<blockquote><span class="indexdullblue"> To decide which value is oops word #2:<br>
    &nbsp;&nbsp;&nbsp;&nbsp; (-  'oops'  -)</span></blockquote>

    <p><p><span class="indexblack"><b><span id=docsec6>Section 6: Undoing the current turn</span></b></span></p>
    </p>

    <p> While UNDO is not an action, it is possible to trigger undo from an action. Under the hood, Inform saves the game after reading a command but before parsing it. UNDO then restores to this point, with a signal to read a new command. Inform must do the save very early in the command processing cycle in order to avoid any accidental side-effects in author-written parsing or action processing routines. However, UNDO (and OOPS) have to be processed before this save; otherwise they will restore to just before the player typed &quot;UNDO&quot;, rather than before the previous command!</p>

    <p> However, you can use this to your advantage. If at the end of a very long and complicated turn which changed a lot of world state, you decide the player probably shouldn't have done that, you can issue an undo order and restore the game to just before the player issued that command. This will undo the current turn -- not the previous turn.</p>

    <p><blockquote><span class="indexdullblue"> undo the current turn;</span></blockquote>

    <p> This can be combined with &quot;disable saving of undo state&quot;, as demonstrated in &quot;Purgatory II&quot;.</p>

    <p> You can also prevent the player from undoing and still use this in your code.</p>

    <p><p><span class="indexblack"><b><span id=docsec7>Section 7: Repairing an empty command</span></b></span></p>
    </p>

    <p> This version integrates the extension Empty Command Handling by Daniel Stelzer, based on code by Matt Weiner. Because Empty Command Handling replaces the same underlying library code as Undo Output Control, it cannot be used with Empty Command Handling; so the entirety of the extension has been integrated.</p>

    <p> This extension adds a new activity, &quot;repairing an empty command&quot;. When the player presses ENTER at the prompt, without typing anything, the &quot;repairing an empty command&quot; activity will be run before showing the parser error. This can be used to give better responses to empty input without hacking into the response system.</p>

    <p> For instance:</p>

    <p> Rule for repairing an empty command: change the text of the player's command to &quot;look&quot;.</p>

    <p> This happens early enough in parsing that even special commands like &quot;undo&quot; and &quot;oops&quot;, or a sequence of commands separated by periods, can be inserted.</p>

    <p><p><span class="indexblack"><b><span id=docsec8>Section 8: Using this extension with Conditional Undo by Jesse McGrew</span></b></span></p>
    </p>

    <p> Jesse McGrew's Conditional Undo extension is compatible with Undo Output Control. It provides an activity-based interface to undo suspension which some authors may prefer. If Conditional Undo is included in our project, the &quot;suspend undo&quot; and &quot;reinstate undo&quot; phrases provided by Undo Output Control will not be available. IMPORTANT: The directive to include Conditional Undo must appear in your source text before the instruction to include Undo Output Control, or the extensions will not function as expected.</p>

    <p> Instead of using the &quot;report attempt to undo-while-disabled&quot; rulebook to respond to suspended UNDO, users of Conditional Undo should use the &quot;rule for deciding whether to allow undo&quot; activity (see the Conditional Undo documentation).</p>

    <p><p><span class="indexblack"><b><span id=docsec9>Section 9: Using this extension with Unified Glulx Input by Andrew Plotkin</span></b></span></p>
    </p>

    <p> Unified Glulx Input has its own method for turning UNDO on and off; these all work, as do the methods in this extension.</p>

    <p> Unified Glulx Input has its own method for redefining the words which trigger UNDO, so the method in this extension does not work for &quot;undo&quot; words. However, &quot;oops&quot; words can still be changed using this extension.</p>

    <p> Unified Glulx Input has its own (superior) method for dealing with blank lines; &quot;repairing an empty command&quot; is not implemented.</p>

    <p><p><span class="indexblack"><b><span id=docsec10>Section 10: Change log</span></b></span></p>
    </p>

    <p><blockquote><span class="indexdullblue"> v5 - Add &quot;undo the current turn&quot;, documentation, and example. (Nathanael Nerode) Integrate Empty Command Handling by Daniel Stelzer. Make compatible with Unified Glulx Input.</span></blockquote>

    <p><blockquote><span class="indexdullblue"> v4 - Substantial updates by Nathanael Nerode. Update to 6M62. Fix bugs. Improve documentation.</span></blockquote>

    <p><blockquote><span class="indexdullblue"> v3 - Removed unnecessary check of the &quot;before undoing an action&quot; rulebook at the end of the game. This caused an UNDO typed at the end of the game to fail silently.</span></blockquote>

    <p><blockquote><span class="indexdullblue"> v2 - Added suspension of game state saving and the Breaking Glass and Purgatory examples. Also added the ability to change word constants. Fixed minor bug in operation of undo suspension.</span></blockquote>

    <p><blockquote><span class="indexdullblue"> v1 - Initial release.</span></blockquote>

    <p><hr>
    <table border="0" cellspacing="0" cellpadding="0">
        <tr>
            <td halign="left" valign="top" cellpadding=0 cellspacing=0 width=38px>
                <span id=eg1><table border="0" cellspacing="0" cellpadding="0">
                    <tr class="oval">
                        <td width=38px height=30px align="left" valign="center">
                            <div class="paragraph Body" style="line-height: 1px; margin-bottom: 0px; margin-top: 0px; padding-bottom: 0pt; padding-top: 0px; text-align: center;">
                                <span class="extensionexampleletter">A</span></div>
                            
                        </td>
                    </tr>
                </table>
                </span>
            </td>
            <td cellpadding=0 cellspacing=0 halign="left" valign="top">
                <img border="0" src='../../../doc_images/asterisk.png'><b><span class="indexdarkgrey">&nbsp;Example&nbsp;</span><span class="indexblack">Mynah Undo</span></b><br>
                <p>Presents report rules that reproduce Inform's default output.</p>

            </td>
        </tr>
    </table>
    <table border="0" cellspacing="0" cellpadding="0" class="extensionexample" width=100%>
        <tr>
            <td align="left" valign="top">
                <p></p>

                <p><blockquote><span class="indexdullblue"><img border=0 src=../../../doc_images/paste.png> &quot;Mynah Undo&quot;</span></blockquote>

                <p><blockquote><span class="indexdullblue"> Include Undo Output Control by Erik Temple.</span></blockquote>

                <p><blockquote><span class="indexdullblue"> Laboratory is a room. The pen, the vial, the bunsen burner, the beaker, the banana, and the viol are in Laboratory.</span></blockquote>

                <p><blockquote><span class="indexdullblue"> Report undoing an action:<br>
                &nbsp;&nbsp;&nbsp;&nbsp; say &quot;[bold type]&quot;;<br>
                &nbsp;&nbsp;&nbsp;&nbsp; say &quot;[Location]&quot; in upper case;<br>
                &nbsp;&nbsp;&nbsp;&nbsp; say &quot;[roman type]&quot;;<br>
                &nbsp;&nbsp;&nbsp;&nbsp; say &quot;[line break]&quot;;<br>
                &nbsp;&nbsp;&nbsp;&nbsp; say &quot;[bracket]Previous turn undone.[close bracket][line break]&quot;;<br>
                &nbsp;&nbsp;&nbsp;&nbsp; rule succeeds.</span></blockquote>

                <p><blockquote><span class="indexdullblue"> Report prevented undo:<br>
                &nbsp;&nbsp;&nbsp;&nbsp; say &quot;The use of UNDO is forbidden in this game.&quot;;<br>
                &nbsp;&nbsp;&nbsp;&nbsp; rule succeeds.</span></blockquote>

                <p><blockquote><span class="indexdullblue"> Report nothing to be undone failure:<br>
                &nbsp;&nbsp;&nbsp;&nbsp; say &quot;[bracket]You can't [quotation mark]undo[quotation mark] what hasn't been done![close bracket][line break]&quot;;<br>
                &nbsp;&nbsp;&nbsp;&nbsp; rule succeeds.</span></blockquote>

                <p><blockquote><span class="indexdullblue"> Section (for Glulx only)</span></blockquote>

                <p><blockquote><span class="indexdullblue"> Report interpreter undo failure:<br>
                &nbsp;&nbsp;&nbsp;&nbsp; say &quot;[bracket]You cannot [quotation mark]undo[quotation mark] any further.[close bracket][line break]&quot;;<br>
                &nbsp;&nbsp;&nbsp;&nbsp; rule succeeds.</span></blockquote>

                <p><blockquote><span class="indexdullblue"> Section (for Z-machine only)</span></blockquote>

                <p><blockquote><span class="indexdullblue"> Report interpreter undo failure:<br>
                &nbsp;&nbsp;&nbsp;&nbsp; say &quot;[quotation mark]Undo[quotation mark] failed. [bracket]Not all interpreters provide it.[close bracket][line break]&quot;;<br>
                &nbsp;&nbsp;&nbsp;&nbsp; rule succeeds.</span></blockquote>

                <p></p>

            </td>
        </tr>
    </table>
    <hr>
    <table border="0" cellspacing="0" cellpadding="0">
        <tr>
            <td halign="left" valign="top" cellpadding=0 cellspacing=0 width=38px>
                <span id=eg2><table border="0" cellspacing="0" cellpadding="0">
                    <tr class="oval">
                        <td width=38px height=30px align="left" valign="center">
                            <div class="paragraph Body" style="line-height: 1px; margin-bottom: 0px; margin-top: 0px; padding-bottom: 0pt; padding-top: 0px; text-align: center;">
                                <span class="extensionexampleletter">B</span></div>
                            
                        </td>
                    </tr>
                </table>
                </span>
            </td>
            <td cellpadding=0 cellspacing=0 halign="left" valign="top">
                <img border="0" src='../../../doc_images/asterisk.png'><img border="0" src='../../../doc_images/asterisk.png'><b><span class="indexdarkgrey">&nbsp;Example&nbsp;</span><span class="indexblack">I Love the Sound of Breaking Glass</span></b><br>
                <p>This example shows how to rework the output for UNDO using &quot;report undoing an action&quot;, as well as how to limit both the total number of UNDOs available and the number of consecutive UNDOs allowed.</p>

            </td>
        </tr>
    </table>
    </p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p><hr>
    <table border="0" cellspacing="0" cellpadding="0">
        <tr>
            <td halign="left" valign="top" cellpadding=0 cellspacing=0 width=38px>
                <span id=eg3><table border="0" cellspacing="0" cellpadding="0">
                    <tr class="oval">
                        <td width=38px height=30px align="left" valign="center">
                            <div class="paragraph Body" style="line-height: 1px; margin-bottom: 0px; margin-top: 0px; padding-bottom: 0pt; padding-top: 0px; text-align: center;">
                                <span class="extensionexampleletter">C</span></div>
                            
                        </td>
                    </tr>
                </table>
                </span>
            </td>
            <td cellpadding=0 cellspacing=0 halign="left" valign="top">
                <img border="0" src='../../../doc_images/asterisk.png'><img border="0" src='../../../doc_images/asterisk.png'><b><span class="indexdarkgrey">&nbsp;Example&nbsp;</span><span class="indexblack">Purgatory</span></b><br>
                <p>Illustrates how to suspend and reinstate the saving of undo states. The player is presented with a bottle of poison. If she drinks it, she will die within a certain number of turns. We suspend saving of the undo state on the drinking of the bottle, though, so that the player need type UNDO only once to return to the turn before drinking the poison, no matter how many turns have passed since.</p>

            </td>
        </tr>
    </table>
    </p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p><hr>
    <table border="0" cellspacing="0" cellpadding="0">
        <tr>
            <td halign="left" valign="top" cellpadding=0 cellspacing=0 width=38px>
                <span id=eg4><table border="0" cellspacing="0" cellpadding="0">
                    <tr class="oval">
                        <td width=38px height=30px align="left" valign="center">
                            <div class="paragraph Body" style="line-height: 1px; margin-bottom: 0px; margin-top: 0px; padding-bottom: 0pt; padding-top: 0px; text-align: center;">
                                <span class="extensionexampleletter">D</span></div>
                            
                        </td>
                    </tr>
                </table>
                </span>
            </td>
            <td cellpadding=0 cellspacing=0 halign="left" valign="top">
                <img border="0" src='../../../doc_images/asterisk.png'><img border="0" src='../../../doc_images/asterisk.png'><b><span class="indexdarkgrey">&nbsp;Example&nbsp;</span><span class="indexblack">Purgatory II</span></b><br>
                <p>As an additional enhancement, we make an automatic undo attempt after the player has died.</p>

            </td>
        </tr>
    </table>
    </p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p></p>

    <p>
    <!--CONTENT ENDS-->
</body>
</html>
