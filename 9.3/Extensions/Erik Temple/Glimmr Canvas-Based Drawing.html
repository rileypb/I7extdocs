<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Extension</title><script type="text/javascript">	function showExtra(id, imid) {		if (document.getElementById(id).style.display == 'block') {			document.getElementById(id).style.display = 'none';			document.getElementById(imid).src = 'inform:/extra.png';		} else {			document.getElementById(id).style.display = 'block';			document.getElementById(imid).src = 'inform:/extraclose.png';		}	}    function openExtra(id, imid) {    	document.getElementById(id).style.display = 'block';    	document.getElementById(imid).src = 'inform:/extraclose.png';    }    function closeExtra(id, imid) {    	document.getElementById(id).style.display = 'none';    	document.getElementById(imid).src = 'inform:/extra.png';    }</script></head><STYLE TYPE="text/css"><!--*, *:before, *:after {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;}.oval, .oval TD{background-image:url('../../../doc_images/ovoid.png');color:white;}--></STYLE><body><script language="JavaScript">function pasteCode(code) {    var myProject = window.Project;    myProject.selectView('source');    myProject.pasteCode(code);}</script><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><table CELLPADDING=0 CELLSPACING=0 width="100%" bgcolor="#000000"><tr><TD width=38px height=26px align="center" valign="center"><img border=0 src="../../../doc_images/Hookindex.png" border=0></td><TD width=38px height=26px align="center" valign="center"></td><td halign="left" valign="center" CELLPADDING=0 CELLSPACING=0></td><TD width=56px height=26px align="right" valign="center"><img border=0 src="../../../doc_images/Hookup.png" border=0></td></tr></table><p><img border=0 src=../../../doc_images/paste.png>&nbsp;<b>Glimmr Canvas-Based Drawing<font color="#404040"> by </font>Erik Temple</b><p><small></small><p><p><hr><p>
<p>
 Chapter: Concepts
<p>
 Glimmr Canvas-Based Drawing (GCBD) takes an object-oriented approach to drawing in graphics windows. The central concept is the &quot;canvas&quot; (called the &quot;g-canvas&quot; to avoid namespace conflicts). A canvas is similar to the HTML5 &lt;canvas&gt; element: it is a defined area within which graphic elements of various sorts can be displayed. The canvas is basically nothing more than a coordinate system, a blank page which is given certain dimensions. To display a canvas, we assign it to a graphics window (created using the Flexible Windows extension). When the window is opened, the composition we have defined will be displayed, and the canvas--along with all of the graphic elements displayed in it--will automatically be scaled to fit in the window.
<p>
 The graphic elements displayed in the canvas are called &quot;g-elements&quot; (again, to avoid namespace clashes with your code or with other extensions). These are declared as individual objects. GCBD provides four basic types of element:
<p>
<blockquote><font color="#000080"> sprite - displays an image from a file (a &quot;figure&quot; in Inform's terminology).<br> primitive - a simple shape such as a filled rectangle, an outlined box, or an arbitrary line.<br> bitmap - a complex element declared by specifying a grid of on/off or colored &quot;bits&quot;; similar to programming an LED sign.<br> image-map - a complex element declared by specifying a grid of image tiles.<br> rendered string - a complex element in which either image files or bitmaps are used to render arbitrary text strings.</font></blockquote>
<p>
 The element types are discussed in more detail below. Authors can also create their own g-element types if desired; some examples are given in this documentation.
<p>
 Elements are assigned to a canvas, and they can also be set either active or inactive; inactive elements will not be displayed. They can also be scaled relative to the canvas and given z-values (called &quot;display-layer&quot;) to control the way in which objects overlap each other. If we include the Glimmr Graphic Hyperlinks extension, elements can also be made to respond in various ways to mouse input from the player.
<p>
 Chapter: Including Glimmr Canvas-Based Drawing in a project
<p>
 Inform remains fairly unsophisticated in its mechanisms for organizing included extensions. When we are dealing with a complex system of modular extensions such as Glimmr, it is very easy to trip it up, and the result is usually a list of unhelpful errors. For this reason, each Glimmr extension includes a section--such as this one--about how to include it, particularly in relation to other extensions.
<p>
 GCBD should be included before any font or tileset extensions, e.g.:
<p>
<blockquote><font color="#000080"> Include Glimmr Canvas-Based Drawing by Erik Temple.<br> Include Glimmr Image Font by Erik Temple.</font></blockquote>
<p>
 Chapter: Basic Usage
<p>
 Glimmr Canvas-Based Drawing is designed to be easy to use, but also both powerful and flexible. There are four basic steps to using it.
<p>
<blockquote><font color="#000080"> 1) Define a graphics window;<br> 2) Define a canvas to use with that window;<br> 3) Create elements and assign them to the canvas.<br> 4) Activate elements for display.</font></blockquote>
<p>
 Section: Define a graphics window
<p>
 Windows are managed by the Flexible Windows extension, and we can make use of any of the features available in that extension. It is important that the window be defined using the &quot;graphics g-window&quot; kind (or a descendant of this kind):
<p>
<blockquote><font color="#000080"> The graphics-window is a graphics g-window spawned by the main-window.</font></blockquote>
<p>
 You may find it useful to use the Glimmr Simple Graphics Window extension, which will do most of the configuration of the graphics window for you, including assigning a canvas (see the following section). See the Flexible Windows extension for more on creating windows.
<p>
 We also need to be sure that we open the window at some point, using the &quot;open up the &lt;g-window&gt;&quot; phrase, and that we have provided an indication of when the window should be redrawn. For most cases, doing the latter in an every turn rule will suffice:
<p>
<blockquote><font color="#000080"> Every turn: follow the refresh windows rule.</font></blockquote>
<p>
 Section: Define the canvas
<p>
 Defining the canvas is also quite easy. We simply declare the canvas object and associate it with a g-window:
<p>
<blockquote><font color="#000080"> The graphics-canvas is a g-canvas. The associated canvas of the graphics-window is the graphics-canvas.</font></blockquote>
<p>
 We should also specify the dimensions of the canvas. There are two ways to do this. We can set the width and height directly:
<p>
<blockquote><font color="#000080"> The canvas-width of the graphics-canvas is 600. The canvas-height of the graphics-canvas is 300.</font></blockquote>
<p>
 Or we can supply a background image for the canvas. The background image will be drawn underneath (that is, before) any of the elements associated with the canvas are drawn. If we have not explicitly set the canvas dimensions as described above, the background image will itself define the dimensions of the canvas. We declare the background image like this:
<p>
<blockquote><font color="#000080"> The background image of the graphics-canvas is Figure of Background.</font></blockquote>
<p>
 Again, the background image will only define the canvas dimensions for us if we have not specified dimensions, or if we have specified either the width or the height at 0. If, on the other hand, we have specified dimensions in advance, the background image will be resized to fit the previously defined dimensions. It will even be stretched to fit if need be.
<p>
 Section: Create elements and assign them to the canvas
<p>
 Finally, we need to create some elements (called g-elements in Inform to avoid namespace issues) and assign these to our canvas.
<p>
 Elements are things, in Inform's sense of the term. The player cannot see or refer to them (they are given the &quot;privately-named&quot; and &quot;scenery&quot; properties by default), and we will generally create them off-stage, but authors can declare and manipulate them just like any other thing.
<p>
 Each type of element (sprite/image, primitive, bitmap, image-map, or text) needs to be declared with its own set of properties that define its behavior. This is generally a simple process; in fact, the Glimmr Canvas Editor extension allows you to arrange elements visually using a GUI interface and will output appropriate element definitions in I7 source code for you. Here is an example of definitions for a few different types of element:
<p>
<blockquote><font color="#000080"> The Player Avatar is a sprite. The image-ID is Figure of Player. The origin is { 10, 10 }.</font></blockquote>
<p>
<blockquote><font color="#000080"> The Violet Border is a rectangle primitive. The origin is { 100, 100 }. The endpoint is { 200, 200 }. The tint is g-Lavender.</font></blockquote>
<p>
<blockquote><font color="#000080"> The Title Text is a bitmap-rendered string. The origin is { 120, 110 }. The text-string is &quot;My Great Game: An Interactive Pile of Awesome&quot;. The font is Glimmr C&amp;C. The tint is g-Red. The bit-size is 2.</font></blockquote>
<p>
 (Please see the guide below for an explanation of the properties of elements.)
<p>
 By the far the best way to define a set of g-elements is with a table. This is much briefer and is legible at a glance. (The Glimmr Canvas Editor can also output its source code in a tabular format.) Here is an example of such a table (Inform unfortunately scrambles formatting in documentation, so not all formatted examples will look right):
<p>
<blockquote><font color="#000080"> Table of Room Elements</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> sprite</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> origin</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> image-ID</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> display-layer</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> scaling factor</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Horizontal_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 63, 89 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Horizontal</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Round_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 87, 112 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Round</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Stair_Circular_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 95, 121 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Stair Circular</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.7000</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Hall_Vertical_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 68, 131 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Hall Vertical</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font></font></td></tr></table></blockquote>
<p>
 Each g-element must be assigned to a canvas. If we have only one canvas, we can simply assign all elements to that canvas at a stroke (this is what the Glimmr Simple Graphics Window extension does):
<p>
<blockquote><font color="#000080"> The associated canvas of a g-element is the graphics-canvas.</font></blockquote>
<p>
 If we have more than one canvas, we can assign each element individually:
<p>
<blockquote><font color="#000080"> The Player Avatar is a sprite. The image-ID is Figure of Player. The origin is { 10, 10 }. The associated canvas is the graphics-canvas.</font></blockquote>
<p>
 In general, however, the best way to organize elements--especially when we have a lot of them--is to organize them using sub-kinds. We can then assign any property, including the associated canvas, using the appropriate sub-kind. For example, if we are making a map where each room has its own sprite (image element), we could do something like this:
<p>
<blockquote><font color="#000080"> A room-sprite is a kind of a sprite. The associated canvas of a room-sprite is the map-canvas. The display-layer of a room-sprite is 2.</font></blockquote>
<p>
<blockquote><font color="#000080"> Some room-sprites are defined by the Table of Room Elements.</font></blockquote>
<p>
... and now we can proceed to declare all of the room elements in a single table, and they will automatically be assigned to the appropriate canvas and display-layer.
<p>
 Section: Activate elements for display
<p>
 Each time a graphics window is redrawn, Glimmr iterates through the elements that are associated with that window's current canvas. If the element is marked for display, the element is drawn to the screen according to the parameters we have specified. If it is not marked for display, it is ignored. We set the display status to either g-active (marked for display) or g-inactive to initialize it.
<p>
 All elements are marked for display by default, so if we say nothing about the display status of an element when we define it, it will display as soon as the appropriate graphics window is opened.
<p>
 Very often, however, we do not want all of our elements on all of the time; a more dynamic approach is desired. For example, If we have designed a map in which each room is represented by a sprite, we want only the rooms that a player has visited to be displayed. We might begin by defining all of these as of the sub-kind room-sprite, and then mark all of them as initially not for display:
<p>
<blockquote><font color="#000080"> A room-sprite is a kind of a sprite. The associated canvas of a room-sprite is the map-canvas. A room-sprite has a room called the associated room. The display status of a room-sprite is g-inactive.</font></blockquote>
<p>
 Now, none of our rooms will show up when the map window is first opened. If we add a rule to the rules for the looking action, which are carried out each time we enter a room, we can cause rooms to display as we enter them (note that we have added a property here to room-sprites, the &quot;associated room,&quot; which represents the room that the sprite depicts):
<p>
<blockquote><font color="#000080"> Carry out looking:<br>&nbsp;&nbsp;&nbsp;&nbsp; Repeat with current-element running through room-sprites:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the associated room of the current-element is the location:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if current-element is display-inactive:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; activate the current-element.</font></blockquote>
<p>
 &quot;Activate &lt;a g-element&gt;&quot; is a shortened way of writing &quot;change the display status of &lt;g-element&gt; to g-active.&quot; (We can also use &quot;mark &lt;g-element&gt; for display&quot;.) To mark an element inactive, we use &quot;deactivate &lt;g-element&gt;&quot; or &quot;unmark &lt;g-element&gt; for display&quot;. Finally, we can test whether an element is currently active or inactive by using one of the following phrases:
<p>
<blockquote><font color="#000080"> if &lt;g-element&gt; is display-active<br> if &lt;g-element&gt; is display-inactive</font></blockquote>
<p>
 There are many appropriate ways to manage the display of elements. The examples below will provide more ideas.
<p>
 And those are the basic steps in using Glimmr Canvas-Based Drawing. The remainder of this documentation explores the element types and other options in more detail, and also explores intermediate and advanced usage of the extension. Finally, the examples illustrate basic usage as well as a number of techniques that are likely to be of interest.
<p>
 Chapter: Kinds of element
<p>
 Section: Sprites
<p>
 In common computer-graphics usage, a sprite is an independent image that comprises part of a larger scene, most commonly a two-dimensional image such as the moving characters in a video game. This definition also holds true for GCBD. (Experienced graphics folk should note that there is no &quot;sprite sheet,&quot; however; each entity comes from a separate image file.) Sprites are likely to be the most common element used in GCBD games, being the most flexible elements and, at small to moderate sizes, also the fastest to draw.
<p>
 The image files used with sprites can be in PNG or JPEG format. (PNG is recommended, since you can use alpha channels to create transparency, allowing for irregular shapes.) To use an image file as a sprite element, we must first declare the external image file (can be in PNG or JPEG format) as a figure in Inform:
<p>
<blockquote><font color="#000080"> Figure of Scroll is the file &quot;Scroll_background.png&quot;.</font></blockquote>
<p>
 The figure must then be assigned to the sprite by setting the 'image-ID' property of the sprite object to the figure name, e.g. &quot;The image-ID of the scroll is Figure of Scroll&quot;. If you have more than a handful of sprites, it can be much faster to declare them using tables; see Chapter5 of the Inform manual.
<p>
 Like other g-elements, sprites have a coordinate pair, the &quot;origin&quot; property, that determines where in the canvas coordinate system the upper-left corner of the sprite will be displayed. Sprites can be scaled if desired, using the &quot;scaling factor&quot; property. This scaling factor is calculated before the canvas is scaled to fit the window; in other words, the scaling factor property of the sprite scales it in relation to the rest of the canvas. If the asymmetrical scaling use option is set, it will be necessary to set both the &quot;x-scaling factor&quot; and the &quot;y-scaling factor&quot; of the sprite; these can, of course, be set to different values to allow the sprite to be &quot;stretched&quot; to an aspect ratio other than the original aspect ratio.
<p>
 Note: When sprites are intended to fit together tightly on screen, as for example image tiles, we will have more flexibility if we design the tiles so that they overlap one another. In other words, where they will abut one another, we should include an extra margin of 1-3 pixels in each image. This will ensure that, if the sprites are scaled, the inaccuracies inherent in scaling do not create visible seams between sprites.
<p>
 Section: Primitives
<p>
 A primitive element is a simple shape that is generally intended to be used in concert with other shapes and images to build up a composition; for example, rectangles and lines. The meaning of a graphics primitive is somewhat stretched here, since the only primitive actually provided by Glulx is a simple rectangle, whereas all of the other &quot;primitives&quot; provided by Glimmr Canvas-Based Drawing are in fact built up out of rectangles. The most intensive of these, the line primitive, can be made up of many, many rectangles and may be quite slow to draw. The primitives included with GCBD are:
<p>
<blockquote><font color="#000080"> Rectangle primitive - A simple rectangle of color.</font></blockquote>
<p>
<blockquote><font color="#000080"> Box primitive - An &quot;empty&quot; rectangle defined by a surrounding line of variable thickness.</font></blockquote>
<p>
<blockquote><font color="#000080"> Stroked rectangle primitive - A rectangle of color surrounded by a line of another color. Basically, a rectangle primitive with a box primitive drawn around it. (Not really a &quot;primitive&quot;, then, but the algorithm used draws this faster than using the two primitives, so it makes sense to provide it.)</font></blockquote>
<p>
<blockquote><font color="#000080"> Line primitive - A straight line drawn between any two points. Horizontal and vertical lines will be the fastest to draw. Diagonal lines, especially long lines or lines approaching a 45 degree angle, can be much slower.</font></blockquote>
<p>
<blockquote><font color="#000080"> Point primitive - A rectangle whose size is defined by its line-weight.</font></blockquote>
<p>
 Primitives have an origin, as do all g-elements, and they also have a second coordinate pair, the &quot;endpoint&quot;. For most primitives, the origin describes the upper left corner, while the endpoint describes the lower right corner. The line primitive, however, is freer--the two points can in fact have any relationship. Because the size of primitive elements is defined by two points on the canvas, they cannot be scaled at the element level in the same way as sprite elements can (they will, of course, scale along with the canvas).
<p>
 Four primitives--the box, line, and stroked rectangle primitives--have a &quot;line-weight&quot; property that defines the thickness of the lines that make them up. This is the only property of primitives that responds to scaling. The response is coarse, however, because line-weight is measured in pixels. Fractional pixel measurements are not possible, and are rounded to the nearest integer. For example, if you define a line-weight of 2 pixels, the line will appear as two pixels wide when the canvas is scaled down to 75% of full size, but will appear as 1 pixel when scaled to 74% or less.
<p>
 The color of a primitive is specified using the &quot;tint&quot; property. This is a glulx color value (see the Glulx Text Effects extension). Some primitives (the stroked rectangle) also have a &quot;background tint&quot; property that supplies a second color value, in this case the color of the &quot;stroke&quot; that surrounds the central fill of the rectangle.
<p>
 Section: Bitmaps
<p>
 A bitmap element draws a rectangular image composed of individual &quot;bits&quot; that are specified by the author in the form of a list of lists (the &quot;bitmap-array&quot;) that defines the status of each bit. For example, a cross might be specified like so:
<p>
<blockquote><font color="#000080"> {<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 0, 1, 0, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 0, 1, 0, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 1, 1, 1, 1, 1 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 0, 1, 0, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 0, 1, 0, 0 }<br> }.</font></blockquote>
<p>
 The ones represent bits that are turned on, while the zeros represent bits that are off. Each row is given as a list of numbers with its own set of braces.
<p>
 Remember that the bitmap-array is a list of lists of numbers. We supply the standard set of list braces, and then we supply one list for each row within those braces, each row's list also having its own braces, e.g. here's a simple map with 4 rows:
<p>
<blockquote><font color="#000080"> { { 1, 0, 1 }, { 0, 1, 0 }, { 1, 0, 1 }, { 0, 1, 0 } }.</font></blockquote>
<p>
 It is very important that all rows have the same number of entries (i.e., columns).
<p>
 When image files such as PNGs or JPEGs are scaled, pixels can be interpolated so that the image file can be presented at virtually any scaling factor. However, the pixels of a bitmap element are set directly, and so the individual pixel is the primary unit of measurement (a bitmap displayed with a bit-size of 2 will be twice as wide and twice as high as the same bitmap displayed with a bit-size of 1). Fractional pixel measurements are not possible, and the bit-size is rounded to the nearest integer. So, if you define a bit-size of 2 pixels, the bit will be 2 pixels from 75% to 100% of full size, but will appear as 1 pixel when scaled to 74% or less. The screen size of the bitmap is determined by the bit-size and the dimensions of its grid: a 10 x 10 bitmap with a scaled bit-size of 2 will occupy 20 x 20 pixels on the screen.
<p>
 The &quot;on&quot; bit of a bitmap is rendered using the color provided by the &quot;tint&quot; property (defaults to black). The &quot;off&quot; bit can be implemented in one of two ways. If the &quot;background tint&quot; property is specified, the &quot;off&quot; bit will be rendered using the background color. If the &quot;background tint&quot; property is not set, the &quot;off&quot; bit will do nothing (anything drawn beneath the bitmap will show through the off bits). Both the tint and background tint properties are specified using the glulx color value kind of value (see the Glulx Text Effects extension).
<p>
 There are two types of bitmaps:
<p>
<blockquote><font color="#000080"> Monochrome bitmap - Each bit is either on or off. The &quot;on&quot; bit is specified using 1, the &quot;off&quot; bit using 0.</font></blockquote>
<p>
<blockquote><font color="#000080"> Polychrome bitmap - RGB color are provided directly in the bitmap-array. RGB colors must be specified using a decimal version of the hexadecimal representation of the color (see Glulx Text Effects for more information). In a polychrome bitmap, the &quot;off&quot; bit is specified using a negative number (rather than 0 as with a monochrome bitmap).</font></blockquote>
<p>
 Polychrome bitmaps are not as human-readable as monochrome ones (white, for example, will be listed in the bitmap-array as 16777215), but they are a bit more flexible.
<p>
 Section: Image-maps
<p>
 An image-map is similar to a bitmap in that the author defines a regular grid for graphical display. However, rather than each cell of the grid displaying a rectangular area of color, it draws an image from a PNG or JPEG file. This could be used for drawing tile-based maps (as in RPG games), sliding-block puzzles, graphical user interfaces, or a number of other things.
<p>
 There are two types of image-maps:
<p>
<blockquote><font color="#000080"> Tileset image-map - Specified using a list of lists of numbers called the &quot;tile-array&quot;, where each row is given as a list of numbers. These numbers are keyed to an &quot;associated tileset&quot;, basically a translation-table that converts the digits to figure names. The tileset allows for one set of images to be changed out for another with a single line; for example, a map could change from day to night simply by changing the image-map's associated tileset. Tilesets also allow image-map lists to be relatively human-readable. For example, the following might represent a long hallway with a door on the left:</font></blockquote>
<p>
<blockquote><font color="#000080"> {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { 11, 11, 11, 11, 11, 11, 11 },<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { 05, 00, 00, 00, 00, 00, 00 },<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { 05, 00, 00, 00, 00, 00, 00 },<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { 11, 11, 11, 11, 11, 11, 11 }<br>&nbsp;&nbsp;&nbsp;&nbsp; }</font></blockquote>
<p>
<blockquote><font color="#000080"> Direct image-map - Specified using a list of lists of figure names called the &quot;figure-array&quot;, where each row is given as a list of numbers. When typed out, the figure-array will be more difficult to read than a tileset-array, at least when there are more than a few cells in the grid. The figure-array of a simple six-cell grid might read like this:</font></blockquote>
<p>
<blockquote><font color="#000080"> {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { Figure of Red, Figure of Blue },<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { Figure of Blue, Figure of Red },<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { Figure of Red, Figure of Blue }<br>&nbsp;&nbsp;&nbsp;&nbsp; }</font></blockquote>
<p>
<blockquote><font color="#000080"> When adding graphic hyperlinks to individual cells, we will need to include a separate tile that keys commands to figure names (in a tileset image-map, this is handled by the tileset's translation-table).</font></blockquote>
<p>
 There are times when we may not want to include any graphic in a given cell. For a tileset image-map, we can simply provide 0 as the value for that cell, while for a direct image-map, we specify Figure of Null. If we specify a &quot;background tint&quot; (a glulx color value) for the image-map element, a rectangular zone of this color will be drawn behind the image-map, and will &quot;show through&quot; any empty cells, as well as through the transparent areas of PNG graphics included in the image-map.
<p>
 Remember that the tile- or figure-array is a list of lists. We supply the standard set of list braces, and then we supply one list for each row within those braces, each row's list also having its own braces, e.g. here's a simple tile-array with 4 rows:
<p>
<blockquote><font color="#000080"> { { 1, 0, 1 }, { 0, 1, 0 }, { 1, 0, 1 }, { 0, 1, 0 } }.</font></blockquote>
<p>
 We must also specify the width and height of the tiles in an image-map. For a direct image-map, we set the &quot;tile-width&quot; and &quot;tile-height&quot; properties to specify these dimensions. The associated tileset should define these for tileset image-maps, but we can also override the tileset settings by specifying the &quot;tile-width-override&quot; and &quot;tile-height-override&quot; properties of the image-map element.
<p>
 If we know the total width or total height we want an image-map to fit into, we can also automate the specification of these properties using these phrases:
<p>
<blockquote><font color="#000080"> fit my image-map to a total width of 120 canvas units;<br> fit my image-map to a total height of 150 canvas units;</font></blockquote>
<p>
 Be sure to invoke these before drawing the image-map for the first time. The extension will attempt to get as close as possible to these measurements, but may not be able to match exactly; for best results, make your final measurement evenly divisible by the number of tiles in the row or column (120 canvas units divided by 10 cells = 12 units each). Use Glimmr debugging (see below) to see the final dimension selected.
<p>
 Like other graphic elements, image-maps can be &quot;hyperlinked&quot; to respond to mouse input. However, unlike other elements, there are two ways in which they can be so linked. As with other elements, the entire rectangular area of the image-map can be given a single link, by assigning the &quot;linked replacement-command&quot; property and changing the &quot;graphlink status&quot; to g-active.
<p>
 But we can also link each tile individually. This is done by making the &quot;tiled graphlink status&quot; of the image-map g-active. We must also specify an array of commands the same size and shape as our image array, the &quot;linked command array&quot; (again, this is a list of lists, this time a list of lists of texts). Luckily, this can be done automatically if we first assign a command to each tile or figure used in the image-map. With a tileset image-map, we can do this by adding a text column called &quot;linked command&quot; to the tileset's translation-table, e.g.:
<p>
<blockquote><font color="#000080"> Table of My Tileset</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Char</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Tile</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Linked Command</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> number</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> figure-name</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> text</font></font></td></tr></table></blockquote>
<p>
 For direct image-maps, which do not have a translation table, we will need to supply a new table, with figure names in one column and commands in a second column. For example:
<p>
<blockquote><font color="#000080"> Table of My Image Maps Commands</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Linked Command</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> figure name</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> text</font></font></td></tr></table></blockquote>
<p>
 After we have set up these correspondences between image tiles and commands, we can use one of the following phrases to build the hyperlink list:
<p>
<blockquote><font color="#000080"> For tileset image-maps:<br>&nbsp;&nbsp;&nbsp;&nbsp; construct graphic hyperlinks array for my image-map.</font></blockquote>
<p>
<blockquote><font color="#000080"> For direct image-maps:<br>&nbsp;&nbsp;&nbsp;&nbsp; construct graphic hyperlinks array for my image-map using the Table of My Image Maps Commands.</font></blockquote>
<p>
 These phrases should be deployed immediately after changing the image array of an image-map, but before drawing it. This will guarantee that the hyperlink zones applied to the screen correspond to the figures shown in the image-map. (We can also write our own routines to populate the linked command array.)
<p>
 Individual links can work alongside the global hyperlink for the entire image-map: wherever an individual tile is not linked--that is, where no tile is drawn to the screen, or when the linked command specified is empty (&quot;&quot;) --the image-map's global hyperlink will be triggered. Otherwise, the individual links override the global link.
<p>
 We can refer to image-maps by their internal coordinates in limited ways. The internal coordinates are expressed using curly braces like canvas coordinates, but they refer to the column and row of a cell in the map. For example, refer back to our &quot;hallway&quot; map:
<p>
<blockquote><font color="#000080"> { 11, 11, 11, 11, 11, 11, 11,<br> 05, 00, 00, 00, 00, 00, 00,<br> 05, 00, 00, 00, 00, 00, 00,<br> 11, 11, 11, 11, 11, 11, 11 }</font></blockquote>
<p>
 If we want to refer to the 05 on the left side of the second row, we would point to { 1, 2 }. We can change the image array of an image-map using internal coordinates like so:
<p>
<blockquote><font color="#000080"> place tile 17 at coordinate { 1, 2 } of my image-map;<br> place Figure of Open Door at coordinate { 1, 2 } of my image-map;</font></blockquote>
<p>
 (The former is for tileset image-maps, the latter for direct image-maps.) Changes, of course, are not visible until the next time we update the window.
<p>
 We can also convert between the internal coordinates of an image-map and the coordinates of the canvas. This allows us to find out where on the canvas a given cell of an image-map is located (the coordinate returned represents the upper left corner of the tile). To get the canvas coordinates of an internal coordinate pair, we refer to:
<p>
<blockquote><font color="#000080"> the canvas coordinate equivalent of { 5, 5 } in the internal coordinates of my image-map;</font></blockquote>
<p>
 To get the internal coordinates corresponding to a given canvas coordinate:
<p>
<blockquote><font color="#000080"> the equivalent of canvas coordinates { 150, 200 } in the internal coordinates of my image-map;</font></blockquote>
<p>
 So, for example, we can place other graphic elements (e.g. sprites) as if they were part of the image-map:
<p>
<blockquote><font color="#000080"> Element display rule for Mario:<br>&nbsp;&nbsp;&nbsp;&nbsp; now the origin of the Mario is the canvas coordinate equivalent of { 5, 5 } in the internal coordinates of my image-map;<br>&nbsp;&nbsp;&nbsp;&nbsp; continue.</font></blockquote>
<p>
 We can also convert between the internal coordinates of an image-map and screen coordinates. This can only be done after the element scaling rules for the image-map have been followed (otherwise the extension will not know what the conversion factor should be). We use the following phrases:
<p>
<blockquote><font color="#000080"> screen coordinate equivalent of { 5, 5 } in the internal coordinates of my image-map;<br> equivalent of screen coordinates { 150, 200 } in the coordinates of my image-map;</font></blockquote>
<p>
 There are a few special debugging capabilities available for image-maps. To see which tiles of an image-map have individual graphic hyperlinks, declare this use option:
<p>
<blockquote><font color="#000080"> Use image-map graphlink preview.</font></blockquote>
<p>
 Now any image-map tile that has an individual hyperlink (see above) will be outlined in gray. The preview color can be changed like so:
<p>
<blockquote><font color="#000080"> The graphlink preview color is g-Blue.</font></blockquote>
<p>
 If the graphlink preview color is set to null (that is, g-PlaceNullCol), no box will be visible.
<p>
 We can &quot;dump&quot; the data in an image-map to the screen by typing &quot;image-map &lt;the name of the image-map to dump&gt;&quot; in-game. If we are running the game in the IDE, this will print the tile-array or figure-array of the image-map to the main window. Note that if the command indicates that there is no such thing as the image-map you're trying to dump, you will need to declare your image-map to be &quot;publically-named&quot;. (GCD automatically tries to mark all g-elements as publically-named for a debugging build, but it is possible to evade this control.) Example:
<p>
<blockquote><font color="#000080"> My image-map is a tileset image-map. The origin is { 10, 10 }. The tile-array is { 1, 2, 1, 2 }.</font></blockquote>
<p>
<blockquote><font color="#000080"> Section - Debugging (not for release)</font></blockquote>
<p>
<blockquote><font color="#000080"> My image-map is publically-named.</font></blockquote>
<p>
 Note that image-maps may run particularly slowly in the IDE. Test them in an outside interpreter to gauge true performance.
<p>
 Section: Rendered strings
<p>
 A rendered string is a graphic element that renders an indexed text string graphically. The string is read character by character from the element's &quot;text string&quot; property, and each character is drawn to the screen using either an image file or a bitmap. Note that rendered strings are not accessible to screen readers.
<p>
 Rendered strings need to have a font specified in their &quot;associated font&quot; property in order to function. A font in this sense is a special kind of object; its major task is to link letterforms (images or bitmaps), via a lookup table, with the characters they are meant to represent. Two fonts are available with Glimmr (Glimmr Image Font and Glimmr Bitmap Font), and authors are of course free to create their own fonts (see the documentation for Glimmr Drawing Commands).
<p>
 Rendered strings can be left-aligned (the default), center-aligned, or right-aligned; the alignment determines whether the origin coordinate will represent the upper left, the upper center point, or the upper right of the rendered text.
<p>
 Rendered strings can manage the display of a cursor, which is drawn as a simple vertical line whose color is determined by the &quot;tint&quot; property of the rendered string (see below). This functionality is not likely to be useful except when paired with something like the Glimmr Canvas Text Input Fields extension, which handles mouse and keyboard input to allow for input to be accepted and understood via a graphics window. To display a cursor, provide a number 0 or greater via a rendered string's &quot;cursor&quot; property. This represents the position after which the cursor will be placed; e.g. with a cursor value of 0, the cursor will appear immediately before the first character in the string. To suppress display of the cursor (the default), provide a negative number for the cursor property.
<p>
 As has been alluded to, there are two types of rendered string:
<p>
<blockquote><font color="#000080"> Bitmap-rendered string - Each glyph is drawn as a bitmap; that is, with individual pixels or 'bits' drawn directly to the screen by Glimmr.</font></blockquote>
<p>
<blockquote><font color="#000080"> Image-rendered string - Each glyph is drawn using a separate, external image file, preferably in PNG format.</font></blockquote>
<p>
 A bitmap-rendered string does not require any external image files, only that a valid bitmap font (such as that provided by the Glimmr Bitmap Font extension) be specified as the &quot;associated font&quot;. As with bitmaps, we can set the &quot;bit-size&quot; property to set the size of each bit, and it has the same coarseness in scaling. And as with bitmaps, the &quot;tint&quot; and &quot;background tint&quot; properties define the colors of a bitmap-rendered string, with &quot;tint&quot; providing the color of the letterforms. When a background tint is provided, a single rectangle is drawn encompassing the entire text area of the rendered string.
<p>
 A rendered string, like a sprite, can be provided its own &quot;scaling factor&quot; property to adjust the size of its glyphs relative to the canvas, and it scales with an accuracy comparable to that of sprite elements. If the &quot;background tint&quot; property is supplied (as always, a glulx color value), a rectangle of that color will be drawn behind the rendered string. The &quot;tint&quot; property of an image-rendered string controls only the color of the cursor; the color of the letterforms is set in the image files.
<p>
 Chapter: Settings and options for scaling
<p>
 Section: Asymmetrical scaling
<p>
 Up to this point, we have talked about element scaling factors as if they were unitary; that is, as if both the x and y axes are always scaled by the same amount. And this is in fact true, unless we set the asymmetrical scaling use option:
<p>
<blockquote><font color="#000080"> Use asymmetrical scaling</font></blockquote>
<p>
 Now we can scale elements-most usefully, sprites-asymmetrically, meaning we can stretch or squeeze the element along one axis more than along the other. This will often be less than pleasing aesthetically, but in some cases it can be quite useful.
<p>
 Note that when this option is set, we can no longer use the &quot;scaling factor&quot; property for elements. Instead, we must now specify the &quot;x-scaling factor&quot; and the &quot;y-scaling factor&quot; separately. We must do this for all elements:
<p>
<blockquote><font color="#000080"> The gas mask is a sprite. The x-scaling factor is 0.9800. The y-scaling factor is 0.5000.</font></blockquote>
<p>
 Note that by default, both scaling factors are set to 1.0000, so we really only need to set the scaling factors if we wish to scale to some other factor.
<p>
 Section: Oversize scaling
<p>
 By default, Glimmr Canvas-Based Drawing will only scale a canvas up to its original size, so that 1 unit in the canvas coordinate system equates to 1 pixel on the screen (i.e., a window scaling factor of 1.0000). This ensures high-quality display of image files, which generally do not look good when enlarged. However, if we do want the canvas to be scaled beyond its original size, we can set the &quot;oversize scaling&quot; property of the window to true:
<p>
<blockquote><font color="#000080"> The graphics-window is a graphics g-window spawned by the main-window. Oversize scaling is true.</font></blockquote>
<p>
 This option can, of course, be changed during play if we want to temporarily upscale our canvas for some special effect.
<p>
 Chapter: Elements and mouse input
<p>
 When the Glimmr Graphic Hyperlinks extension is included, graphic elements can be hyperlinked to issue a command or try a stored action when the player clicks on the element onscreen. Glimmr will perform all of the required bookkeeping automatically; we need only define the behavior we want. In most cases, this is as simple as indicating what command should be entered at the command line when a given element is clicked.
<p>
 Before a window can receive mouse input, it must be made capable of doing so. We can do this by setting the g-graphlinked property for the window:
<p>
<blockquote><font color="#000080"> The graphics-window is a graphics g-window. It is g-graphlinked.</font></blockquote>
<p>
 Alternatively, we can simply declare the window to be of the kind &quot;graphlink g-window,&quot; which will set this property automatically. Note that while the property can be changed during play, this is not recommended--the window must be closed and reopened for the change to take effect.
<p>
 Elements must also be set to receive graphlinks. We can do this when the element is declared by setting its &quot;graphlink status&quot; property to active:
<p>
<blockquote><font color="#000080"> Mario is a sprite. The graphlink status is g-active.</font></blockquote>
<p>
 To change the graphlink status during the course of the game, we can use these phrases:
<p>
<blockquote><font color="#000080"> Activate graphlink for Mario.<br> Deactivate graphlink for Mario.</font></blockquote>
<p>
 And we can test whether an element is accepting mouse input by asking whether or not the element is graphlinked:
<p>
<blockquote><font color="#000080"> if Mario is not graphlinked:<br>&nbsp;&nbsp;&nbsp;&nbsp; activate graphlink for Mario.</font></blockquote>
<p>
 We now know how to ensure that our element is accepting mouse input, but we haven't yet told it to do anything in response. The easiest way to program a response is simply to provide the text of the command in the &quot;linked replacement-command&quot; property (see Glimmr Graphic Hyperlinks for other approaches). This indexed text is simply the command we wish to fire when the sprite is clicked. (A linked replacement-command of &quot;&quot; (the default) will be perceived by the player as having had no effect.) Here's a complete definition for a hyperlinked element:
<p>
<blockquote><font color="#000080"> Mario is a sprite. The image-ID is Figure of Mario. The origin is { 58, 45 }. The display-layer is 4. The graphlink status is g-active. The linked replacement-command is &quot;JUMP&quot;.</font></blockquote>
<p>
 And now, as long as the Mario sprite appears in the window, clicking on it with our mouse will result in the command &quot;JUMP&quot; being entered at the command prompt. All of the types of graphic element can be hyperlinked in this way. The entire area of the element, including transparent zones, is hyperlinked, and the hyperlink zone for any element is a single rectangle. This is most notable in the case of line primitives, because the hyperlink zone will be the smallest rectangular area that can completely enclose the line; a 45-degree line will therefore have a square hyperlinked area with the line running from one corner to its opposite.
<p>
 A graphlink-active element that overlaps another in the display layering system will supercede the lower element. That is, if Mario, on display-layer 4, partially overlaps a hyperlinked mushroom sprite on display-layer 3, clicking within the boundaries of the rectangle that defines Mario will cause Mario's, rather than the mushroom's, linked replacement-command to be invoked.
<p>
 The background of a canvas cannot be hyperlinked. We can, however, imitate a clickable background by including a fully transparent sprite image of the same dimensions as the background and placing it on the lowest display-layer (usually display-layer 1).
<p>
 A final note: if we will need to have more than 120 hyperlinked elements active at a single moment, we need to extend the number of blank rows in the Table of Graphlink Glulx Replacement Commands. Graphic Window Sprites manages this table automatically, and we should not attempt to set entries in it directly--the table is rebuilt each time the sprite drawing rules are updated, so direct edits will be disregarded in any case.
<p>
 Chapter: Intermediate and advanced topics
<p>
 Section: The default canvas-based drawing rule
<p>
 GCBD is constructed around a single, rather complex window-drawing rule. This drawing rule is automatically used for any g-window of the kind &quot;graphics g-window&quot; (defined by the Flexible Windows extension). Here are the basic steps in the processing of this rule, along with what happens at each stage. For more information on details, of course, please see the code.
<p>
<blockquote><font color="#000080"> 1. Calculate the scaling factor for the window: Check the canvas dimensions against the window dimensions and calculate the scaling factor needed to best fit the canvas in the window. This is handled by the &quot;carry out scaling activity&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> 2. Calculate window offsets: Unless the aspect ratio of the canvas is exactly the same as the window, the scaled canvas will fall short of the window dimension along one or both axes. In this stage, we calculate the offsets necessary to center the canvas in the window. This is handled by the &quot;offset calculation activity&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> 3. Window-framing adjustment: This phase only occurs if we have specified an origin other than { 0, 0 } for the window. If we have, the offsets are again adjusted to account for the fact that we have changed the window framing (see the &quot;Framing the Window&quot; section below). This is handled by the &quot;window-framing adjustment activity&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> 4. Clear the window to prepare for drawing.</font></blockquote>
<p>
<blockquote><font color="#000080"> 5. Draw the canvas background: If the canvas has a background image, we draw it now. This is handled by the &quot;drawing the canvas background activity&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> 6. Draw active graphic elements: Repeat through the display-active elements assigned to the window. For each element, we will first follow the element scaling rules for the element, and then follow the element display rules. This is handled by the &quot;drawing the active elements activity&quot;.</font></blockquote>
<p>
 These steps (except for the clearing of the window) are implemented as activities, so we can add before or after rules to any of them, making the whole system very accessible to modification. Some of the topics and examples which follow illustrate ways to &quot;hack&quot; the process.
<p>
 Section: Using canvases to manage display
<p>
 At first glance, the canvas may almost look unnecessary: elements will be displayed in a graphics window, so why not assign the element directly to the window? Why do we need the canvas to mediate?
<p>
 There are really two answers. First, canvases provide an easy way to change the display content of a graphics window at a stroke. We can, for example, set up two canvases with different elements. We first show Canvas A in our graphics window, and then, when we want to change the content of the window, we simply change the associated canvas of the window to Canvas B. The next time the window refreshes, it will display our second composition. Canvases can thus be used as discrete &quot;pages&quot; to be shown in a graphics window. See the &quot;Two Canvases, One Window&quot; example.
<p>
 We can also display the same canvas in two or more windows at the same time, using different display parameters. So, if we have a detailed map that would benefit from being seen both in close-up and at long-range, we could show the map at one scale in one window, and at another in the other. See the &quot;One Canvas, Two Windows&quot; example.
<p>
 Section: Framing the canvas
<p>
 In normal usage, if the canvas is too large to fit in its associated graphics window, it will be scaled down to fit. Whether the canvas needs to be down-scaled or not, it will also be centered in the window, with offsets on two to four sides (two sides if the canvas has been scaled to fit, four if it is smaller than the window.) There are many ways that we can alter this behavior.
<p>
 First, we can specify our own scaling factor for the window, the &quot;arbitrary scaling factor.&quot; If we set this value, then the canvas will not be automatically scaled to fit the window. Instead it will simply be scaled to our specification:
<p>
<blockquote><font color="#000080"> The arbitrary scaling factor of the graphics-window is 1.0000.</font></blockquote>
<p>
 A ratio of 1.0000 will present the canvas without scaling it, so that one pixel onscreen will be equivalent to one coordinate unit of the canvas. The canvas may or may not fit within the window as the player has sized it, but it will still be centered within the window.
<p>
 Second, a graphics window has an origin coordinate, similar to that of elements. Normally, the origin is { 0, 0 }, which means that the upper left corner of the canvas will be displayed in the upper left corner of the window. (In practice, this placement is usually modified by an offset that centers the canvas within the window, so that the canvas is actually displayed at the origin of the window plus the x and y, or top and left, offsets.) If we change the origin of the window, then the canvas will be framed differently. Setting the window's origin to { 100, 100 }, for example, will place the upper left corner of the window at canvas coordinates { 100, 100 }. Again, this does not account for the offsets, which we may prefer to suppress. Here is one way to suppress the calculation of offsets:
<p>
<blockquote><font color="#000080"> For offset calculation of the graphics-window:<br>&nbsp;&nbsp;&nbsp;&nbsp; change x-offset of the graphics-window to 0;<br>&nbsp;&nbsp;&nbsp;&nbsp; change y-offset of the graphics-window to 0.</font></blockquote>
<p>
 This will replace the standard behavior of the window offset calculation activity in the case of the graphics-window (only--other graphics windows would not be affected) and make sure that no offsets are used in the framing of the window. Note that origins (and any coordinates, really) can be set to negative numbers, or to numbers larger than the canvas dimensions, and they will still display. The elements may not appear in the visible part of the window, but they are there &quot;virtually&quot;.
<p>
 Third, we can center the window frame on a specific point on the canvas. This must be done after the scaling and offset calculation phases of the canvas-based drawing rule; usually it will occur during the window-framing adjustment activity (step 3 of the default canvas-based drawing rule; see above). Here's how to do it:
<p>
<blockquote><font color="#000080"> Before window-framing adjustment of the graphics-window:<br>&nbsp;&nbsp;&nbsp;&nbsp; center the frame of the graphics-window on canvas coordinates { 100, 100 };<br>&nbsp;&nbsp;&nbsp;&nbsp; continue the action.</font></blockquote>
<p>
 This works by changing the origin coordinates of the window. In addition to specifying a coordinate (or a variable containing a coordinate pair), we can also use the special phrase &quot;center-point&quot; of an element, in this case the sprite &quot;Mario&quot;:
<p>
<blockquote><font color="#000080"> Before window-framing adjustment of the graphics-window:<br>&nbsp;&nbsp;&nbsp;&nbsp; center the frame of the graphics-window on the center-point of Mario;<br>&nbsp;&nbsp;&nbsp;&nbsp; continue the action.</font></blockquote>
<p>
 Or, more concisely, we can simply say &quot;center the frame of the graphics-window on Mario,&quot; which will have the same effect.
<p>
 One note: if we have changed the alignment of a graphic element from left-aligned to center-aligned (see the property reference), we will need to specify this differently. Since the origin coordinate of a center-aligned element actually refers to the center-point of the element, we need to say &quot;center the frame of the graphics-window on the origin of Mario&quot;. Centering the window on a right-aligned element will not have the desired effect.
<p>
 Section: Creating new kinds of elements
<p>
 The types of element defined in Glimmr Canvas-Based Drawing are, in most cases, pretty simple. They draw just one entity. But elements need not be so simple. The bitmap and rendered string elements, for example, actually draw many rectangles or images to the screen each time the element is called upon.
<p>
 We can write our own custom rules for drawing elements. The Glimmr Automap extension, for example, creates a new g-element called the map-renderer. This works similarly to a tileset grid: the map-renderer iterates through grid-based map data produced by Mark Tilford's Automap extension, and for each space in the grid, it selects an appropriate tile from a tileset (the tileset is basically a table that relates each bit of map data to a given image). We use the element display rules to write behavior for new elements and element-kinds:
<p>
<blockquote><font color="#000080"> An element display rule for the map-renderer (this is the map-renderer display rule):<br>&nbsp;&nbsp;&nbsp;&nbsp;...<br>&nbsp;&nbsp;&nbsp;&nbsp; repeat with count running from 1 to (map height * map width):<br>&nbsp;&nbsp;&nbsp;&nbsp;...</font></blockquote>
<p>
 Element display rules also typically set a graphic hyperlink for the element being drawn. For all of the types of elements included in the extension, the shape of the hyperlinked area is a simple rectangle. Here, for example, is the element display rule for the rectangle primitive type:
<p>
<blockquote><font color="#000080"> An element display rule for a rectangle primitive (called the rectangle):<br>&nbsp;&nbsp;&nbsp;&nbsp; draw a rectangle (color tint of the rectangle) in (current window) from (win-x) by (win-y) to (end-x) by (end-y);<br>&nbsp;&nbsp;&nbsp;&nbsp; if the rectangle is graphlinked:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set a graphlink in the current window identified as the rectangle from win-x by win-y to end-x by end-y as the linked replacement-command of the rectangle.</font></blockquote>
<p>
 The first line draws the rectangle (see Glimmr Drawing Commands for the syntax of direct drawing commands). If the rectangle has a graphic hyperlink attached, the final line sets a rectangular hyperlink using the same coordinates as the rectangle itself occupies (see Glimmr Graphic Hyperlinks for more on hyperlinks).
<p>
 There is no limit on how many entities we can draw in a single element display rule. If we wanted, for example, to have an element that displayed a sprite with a box drawn around it, we could do so:
<p>
<blockquote><font color="#000080"> An element display rule for an emphasized sprite (called the highlighted item):<br>&nbsp;&nbsp;&nbsp;&nbsp; draw a sprite...<br>&nbsp;&nbsp;&nbsp;&nbsp; draw a box...<br>&nbsp;&nbsp;&nbsp;&nbsp; if the highlighted item is graphlinked:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set a graphlink in the current window...</font></blockquote>
<p>
 We can also set multiple hyperlinks in the same element display rule. If, for example, our g-element is L-shaped, we can set two rectangular hyperlink zones (graphic hyperlink zones are always rectangular) at right angles to one another.
<p>
 Section: Customizing element display
<p>
 We can also use the element display rules to specialize behavior for one element, or for a class of elements, by prefacing or replacing the standard element display rule with another. For example, if we want to create a debugging command to print the name and origin coordinates of each g-element to the main window as it is drawn to our graphics window, we could do something like this:
<p>
<blockquote><font color="#000080"> First element display rule for a g-element (called the item):<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;Element [item] drawn at [origin of the item in brace notation].&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; continue.</font></blockquote>
<p>
 The &quot;continue&quot; is important, because by default the element display rulebook will terminate once a rule completes. The continue directive allows Inform to look for subsequent rules in the rulebook. (We can also use &quot;continue the action,&quot; Inform's standard phrasing, but the element display rules provide &quot;continue&quot; as a shortened form; &quot;exit&quot; similarly serves as a shortened form of &quot;rule succeeds.&quot;)
<p>
 Section: Elements as objects in the world model
<p>
 Since elements are objects, like any other entity of Inform's &quot;thing&quot; kind, we can use their location in space to manage display. If we want an image (or images) to display only when the player is in a certain room, we could put the element object in that room and indicate that elements should only be depicted when the element object is in scope (in most cases, this will be when the player is also in the room). For example, this rule would run before the default canvas-based drawing rule and activate the appropriate elements for display:
<p>
<blockquote><font color="#000080"> First window-drawing rule for a graphics g-window (called the present window):<br>&nbsp;&nbsp;&nbsp;&nbsp; repeat with item running through g-elements assigned to the present window:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the item can be seen by the player:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; activate item;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; otherwise:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; deactivate item;<br>&nbsp;&nbsp;&nbsp;&nbsp; continue the action.</font></blockquote>
<p>
 We could also potentially use other aspects of g-elements--particularly their relationships with one another--as means of organizing their display. I leave users to think about whether this kind of thing might have advantages for them.
<p>
 If for some reason we actually want players to be able to see, pick up, and refer to some elements as if they were objects in the game world, we can declare those elements to be &quot;publically-named&quot;:
<p>
<blockquote><font color="#000080"> Mario is publically-named.</font></blockquote>
<p>
 If we want elements to be publically-named by default, we can replace the section of the extension's code that conceals them from the player, like this:
<p>
<blockquote><font color="#000080"> Chapter - Revealing elements (in place of Chapter - Concealing elements in Glimmr Canvas-Based Drawing by Erik Temple)</font></blockquote>
<p>
 With the body of this section left blank, the privately-named and scenery properties are not set for g-elements, and we can now treat g-elements like any other kind of object: the player will be now able to see and interact with them. Note that g-elements, just like other objects, will be created &quot;off-stage&quot; unless we actively place them in specific rooms.
<p>
 Chapter: Debugging
<p>
 Like all Glimmr extensions, Glimmr Canvas-Based Drawing can utilize the Glimmr debugging log. To use the log, enable this use option:
<p>
<blockquote><font color="#000080"> Use Glimmr debugging.</font></blockquote>
<p>
 Now Glimmr functions will announce themselves, as well as the particular extension that generated them (e.g., Glimmr Canvas-Based Drawing, Glimmr Drawing Commands, etc.) in the main window as they fire. Be warned that, under normal usage, Glimmr generates a lot of debugging information, and can quite thoroughly gum up a game's output. There are a few things we can do to mitigate this:
<p>
<blockquote><font color="#000080"> 1) The Glimmr Debugging Console extension can be included to segregate Glimmr logging output into its own window.</font></blockquote>
<p>
<blockquote><font color="#000080"> 2) We can set up our own alternate text-buffer window and direct log output there by setting the &quot;console output window&quot; variable, e.g.:</font></blockquote>
<p>
<blockquote><font color="#000080"> The console output window is my-text-window.</font></blockquote>
<p>
<blockquote><font color="#000080"> 3) We can also send console log output to the transcript, while not printing it anywhere else. To do this, we include this code in our story file:</font></blockquote>
<p>
<blockquote><font color="#000080"> To say &gt;console:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say echo stream of main-window.</font></blockquote>
<p>
<blockquote><font color="#000080"> To say &lt;:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say stream of main-window;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say run paragraph on.</font></blockquote>
<p>
<blockquote><font color="#000080"> This will only work when a transcript is actually being written. To ensure that we do not forget to initiate one, we can include this:</font></blockquote>
<p>
<blockquote><font color="#000080"> When play begins:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try switching the story transcript on.</font></blockquote>
<p>
 Section: Console log comments
<p>
 When we are sending the debugging info somewhere other than the main window, it can be useful to add notes to the console log to help us interpret it later. We can do this by typing &quot;&gt; &quot; and any text we want to add to the log at the command prompt, e.g.:
<p>
<blockquote><font color="#000080"> &gt; Going west from the Kitchen</font></blockquote>
<p>
 Section: Additional phrases for triggering debugging from source text
<p>
 It can often be useful to control debugging commands from source text, rather than from the command line. For example, we may want to debug the startup sequence, which occurs before the command prompt appears, and thus before we can enter any debugging commands. Glimmr provides the following phrases for controlling the ACTIONS, RULES, RULES ALL, and GLKLIST commands:
<p>
<blockquote><font color="#000080"> ACTIONS<br>&nbsp;&nbsp;&nbsp;&nbsp; activate actions tracing<br>&nbsp;&nbsp;&nbsp;&nbsp; suspend actions tracing</font></blockquote>
<p>
<blockquote><font color="#000080"> RULES<br>&nbsp;&nbsp;&nbsp;&nbsp; activate rules tracing<br>&nbsp;&nbsp;&nbsp;&nbsp; suspend rules tracing<br>&nbsp;&nbsp;&nbsp;&nbsp; if rules tracing is active</font></blockquote>
<p>
<blockquote><font color="#000080"> RULES ALL<br>&nbsp;&nbsp;&nbsp;&nbsp; activate intensive rules tracing<br>&nbsp;&nbsp;&nbsp;&nbsp; suspend rules tracing<br>&nbsp;&nbsp;&nbsp;&nbsp; if intensive rules tracing is active</font></blockquote>
<p>
<blockquote><font color="#000080"> GLKLIST<br>&nbsp;&nbsp;&nbsp;&nbsp; show glk list</font></blockquote>
<p>
 The Extended Debugging extension provides further phrases, as well as other useful features. (Note: Extended Debugging is not part of Glimmr, but works well with it.) See the template layer (Appendix B of Writing with Inform: http://inform7.com/sources/src/i6template/Woven/index.html) for more on these debugging commands.
<p>
 Chapter: Troubleshooting
<p>
 Runtime error &quot;cannot divide by zero&quot; (or similar):
<p>
<blockquote><font color="#000080"> The canvas dimensions have probably not been defined. Be sure you define the canvas before the window-drawing rules are run.</font></blockquote>
<p>
 Inform doesn't recognize the &quot;image-ID&quot; property, or a table in which it is used:
<p>
<blockquote><font color="#000080"> Inform requires a figure to be defined in the source before it can be referred to. Be sure that your figures are defined in the source *above* the text in which you are attempting to define the associated sprites.</font></blockquote>
<p>
 When I click on a hyperlinked element, the game prints a blank line at the command prompt, and then prints my replacement command:
<p>
<blockquote><font color="#000080"> This is how Glk is designed; the line space is unavoidable on most interpreters. A new version of the Glk standard will change this, and Glimmr will be updated when this happens. As of this writing, all major Glulx interpreters will respond in this way except for Zoom, which does not insert the extra line. If the line break bothers you, you may want to recommend Zoom to your OS X and Linux players.</font></blockquote>
<p>
 Performance issues:
<p>
<blockquote><font color="#000080"> Be sure that your images are not too large. Images should be sized no larger than you want them to appear onscreen.</font></blockquote>
<p>
<blockquote><font color="#000080"> Note that games played within the Inform IDE will be slower than games played in an external interpreter. The Mac IDE may sometimes show minor scaling artifacts that are not seen with external interpreters. Try pressing the Release button to produce a blorb file, and play that file in the latest version of a fast, modern interpreter.</font></blockquote>
<p>
<blockquote><font color="#000080"> If you are using Glimmr debugging, the debugging statements in the routines will slow things down. Turn off Glimmr debugging whenever possible.</font></blockquote>
<p>
 Testing:
<p>
 Test your game in all the interpreters you can get your hands on, and recommend the best interpreter (s) to your players. At the time of this writing, Gargoyle and Zoom are both well optimized for graphics and other multimedia effects. Spatterlight on OS X is not, and also has a poor UI for mouse input. Windows Glulxe and Windows Git have a low-resolution timer, and neither is quite as fast with graphic display as Gargoyle, but they should be adequate for most purposes.
<p>
 Chapter: Producing images for use with Glimmr
<p>
 Full instructions for producing images are well beyond the scope of this documentation, but a few notes and links will be useful. For almost all purposes, you will want to produce your images in PNG (Portable Networks Graphics) format. PNG graphics (file extension. png) can contain an &quot;alpha channel&quot; that defines transparent areas of the image, allowing for shapes that are not rectangular. They can be produced with Photoshop, of course, but also with many other programs, including the free, cross-platform GIMP software (http://www.gimp.org). Here are some sites that might be of use to you if you are unfamiliar with PNG graphics (Inform tends to mangle URL spacing in documentation, so you may need to edit these by hand or open the extension itself and copy the links from there into your browser):
<p>
<blockquote><font color="#000080"> http://en.wikipedia.org/wiki/Portable_Network_Graphics<br> http://www.libpng.org/pub/png/pngintro.html<br> http://www.axialis.com/tutorials/tutorial-misc001.html (Photoshop tutorial)<br> http://www.libpng.org/pub/png/book/chapter04.html#png.ch04.div.5 (GIMP tutorial)</font></blockquote>
<p>
 Avoid making your images too large. Images should be sized no larger than you want them to appear onscreen.
<p>
 Chapter: A reference to elements and their properties
<p>
 Here is a list of properties common to all graphic elements (g-elements). Separate sections for each of the element types follows. Properties which the extension uses internally and should not be referred to by the author are also included. These are marked with a double asterisk (**).
<p>
<blockquote><font color="#000080"> associated canvas - the g-canvas with which the element is currently associated. The element will be considered for drawing to the screen when this canvas is drawn.</font></blockquote>
<p>
<blockquote><font color="#000080"> display status - indicates whether or not the element is marked for display (i.e., whether or not it will be drawn to the associated canvas of the element when the window displaying that canvas is updated). Can be g-active (marked for display) or g-inactive. Default value: g-active</font></blockquote>
<p>
<blockquote><font color="#000080"> origin - the x and y coordinates where the element's drawing will be commenced. These coordinates refer to the coordinate system of the canvas and indicate where the upper-left corner of the element will be drawn (usually; see alignment properties below). The origin coordinates are expressed as a list of exactly two numbers in brace notation. Negative numbers are legal. Default value: { 0, 0 }</font></blockquote>
<p>
<blockquote><font color="#000080"> display-layer - a number that defines the &quot;layer&quot; the element will be drawn to, comparable to the z-index in CSS/HTML. Elements with a display-layer of 1 are drawn first, then those with display-layer 2, etc. Lower numbers are thus lower in the stack order. Default value: 1</font></blockquote>
<p>
<blockquote><font color="#000080"> scaling factor - a ratio for scaling the element in relation to its associated canvas. A decimal quantity with four-digit precision, e.g. 0.5000 would scale a sprite image to 50% of its original size (different element types are differentially affected by the scale property; see the discussion of element types above for more information). Actual size is expressed as 1.0000; ratios greater than 1.0000 are allowed (e.g., 2.0000 is equivalent to 200% of actual size). An element's actual displayed size is also subject to adjustment by the window-scaling factor. Default value: 1.0000</font></blockquote>
<p>
<blockquote><font color="#000080"> x-scaling factor - only available when the asymmetrical scaling use option is in force (the scaling factor property is disabled by this same use option). Like the scaling factor property, a decimal quantity with four-digit precision. Scales only the x-axis of an element; most useful for sprites. Default value: 1.0000</font></blockquote>
<p>
<blockquote><font color="#000080"> y-scaling factor - only available when the asymmetrical scaling use option is in force (the scaling factor property is disabled by this same use option). Like the scaling factor property, a decimal quantity with four-digit precision. Scales only the y-axis of an element; most useful for sprites. Default value: 1.0000</font></blockquote>
<p>
<blockquote><font color="#000080"> alignment - defines how an element is drawn in relation to its origin property. When left-aligned, the origin will describe the upper left corner of the element. When center-aligned, the origin will describe the center of the x and y axes of the element. When right-aligned, the origin will describe the lower right corner. It is probably best to declare an element left-aligned whenever possible. Default value: left-aligned</font></blockquote>
<p>
<blockquote><font color="#000080"> graphlink status - indicates whether or not the element is accepting mouse input. Can be g-active (accepting input) or g-inactive. Default value: g-inactive</font></blockquote>
<p>
<blockquote><font color="#000080"> linked replacement-command - an indexed text containing a command that should be entered on the player's behalf when an element has received a mouse-click. The command will be automatically printed to the command line and parsed after clicking. Default value: &quot;&quot; (empty string, will have no visible effect)</font></blockquote>
<p>
<blockquote><font color="#000080"> win-x** - represents the x-coordinate of the element's origin AFTER it has been scaled according to the window's scaling factor; i.e., it refers to the position of the element in the window's coordinate system, not the canvas's. Default value: 0</font></blockquote>
<p>
<blockquote><font color="#000080"> win-y** - represents the y-coordinate of the element's origin AFTER it has been scaled according to the window's scaling factor; i.e., it refers to the position of the element in the window's coordinate system, not the canvas's. Default value: 0</font></blockquote>
<p>
 Section: Summary of sprite properties
<p>
 This section presents a list of the properties associated with sprites, including those that we should not try to set directly. Properties of the latter sort--those which the extension uses internally and should not be referred to by the author--are marked with a double asterisk (**). All sprites also inherit the properties common to the g-element kind (see above for those properties).
<p>
<blockquote><font color="#000080"> image-ID: the figure name of the sprite's associated image file. The default value is null, which can be tested against the special value &quot;Figure of Null&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> sprite-x**: A number that refers to the width of the sprite image after scaling calculations--the final size of the sprite as displayed on screen. Default value: 0</font></blockquote>
<p>
<blockquote><font color="#000080"> sprite-y**: A number that refers to the height of the sprite image after scaling calculations--the final size of the sprite as displayed on screen. Default value: 0</font></blockquote>
<p>
 Section: Summary of the primitive base class's properties
<p>
 This section presents a list of the properties associated with all primitive elements, including rectangle, box, stroked rectangle, line, and point primitives. Properties which the extension uses internally, and should not be referred to by the author, are marked with a double asterisk (**). All primitives also inherit the properties common to the g-element kind (see above for those properties).
<p>
<blockquote><font color="#000080"> endpoint - the x and y coordinates where the element's drawing will be completed. These coordinates refer to the coordinate system of the canvas and usually indicate where the lower right corner of the element will be drawn. In the case of line primitives, the origin and endpoint are more or less interchangeable, neither has priority. The endpoint coordinates are expressed as a list of exactly two numbers in brace notation. Default value: { 0, 0 }</font></blockquote>
<p>
<blockquote><font color="#000080"> tint - a glulx color value (see the Glulx Text Effects extension) that defines the color of the primitive; in the case of the stroked rectangle primitive, this represents the color of the fill fo the rectangle. Default value: g-White</font></blockquote>
<p>
<blockquote><font color="#000080"> end-x** - represents the x-coordinate of the primitive's origin AFTER it has been scaled according to the window's scaling factor; i.e., it refers to the position of the endpoint in the window's coordinate system, not the canvas's. Default value: 0</font></blockquote>
<p>
<blockquote><font color="#000080"> end-y** - represents the y-coordinate of the primitive's origin AFTER it has been scaled according to the window's scaling factor; i.e., it refers to the position of the endpoint in the window's coordinate system, not the canvas's. Default value: 0</font></blockquote>
<p>
 Section: Summary of the properties of the box, stroked rectangle, line, and point primitives
<p>
 This section presents a list of the properties associated with the box, stroked rectangle, line, and point primitives; i.e., those primitives that have a line of variable thickness. Properties which the extension uses internally, and should not be referred to by the author, are marked with a double asterisk (**). These primitives also inherit the properties common to the primitive kind, and to the g-element kind (see above for those properties).
<p>
<blockquote><font color="#000080"> line-weight - the width, in pixels, of either (1) the outline of the box or stroked rectangle primitive; (2) the line of the line primitive; or (3) the square of the point primitive. Default value: 1</font></blockquote>
<p>
<blockquote><font color="#000080"> stroke** - represents the line-weight of the primitive as scaled into the window's coordinate system (i.e., the final thickness of the line as displayed on the screen, in pixels. Default value: 1</font></blockquote>
<p>
 Section: Summary of the properties of the stroked rectangle primitive
<p>
 This section presents a list of the properties associated with the stroked rectangle primitive. Since the stroked rectangle is the only primitive that can incorporate two colors, we use the background tint property to supply the second color (the color of the line). Stroked rectangle primitives also inherit the properties common to the primitive and the g-element kinds (see above for those properties).
<p>
<blockquote><font color="#000080"> background tint - a glulx color value (see the Glulx Text Effects extension) that defines the color of the outline surrounding the central rectangle of the stroked rectangle primitive; i.e., the color of the &quot;stroke&quot; as opposed to the &quot;fill.&quot; Default value: g-White</font></blockquote>
<p>
 Section: Summary of the properties of bitmaps
<p>
 This section presents a list of the properties associated with both monochrome and polychrome bitmaps. Properties which the extension uses internally, and should not be referred to by the author, are marked with a double asterisk (**). All bitmap elements also inherit the properties common to the g-element kind (see above for those properties).
<p>
<blockquote><font color="#000080"> bitmap-array - a list of lists of numbers, written in brace notation, that defines the on and off bits of a bitmap element. Monochrome bitmaps can include only 0 (&quot;off&quot;) or 1 (&quot;on&quot;). Polychrome bitmaps may include any number from 0 to 16777215, defining a decimally packed 16-bit RGB number; in a polychrome bitmap, the &quot;off&quot; bit can be represented by any negative number. Default value: { }</font></blockquote>
<p>
<blockquote><font color="#000080"> tint - a glulx color value (see the Glulx Text Effects extension) that defines the color of the &quot;on&quot; bit of a bitmap. (The &quot;on&quot; bit is given by a 1 in the bitmap-array for monochrome bitmaps; it has no effect for polychrome bitmaps.) Default value: g-White</font></blockquote>
<p>
<blockquote><font color="#000080"> background tint - a glulx color value (see the Glulx Text Effects extension) that defines the color of the background of the bitmap. This color will appear wherever an &quot;off&quot; bit has been specified. (The &quot;off&quot; bit is given by 0 for monochrome bitmaps, and by any negative number for polychrome bitmaps.) Default value: g-PlaceNullCol (the null color value, meaning no background will be drawn)</font></blockquote>
<p>
<blockquote><font color="#000080"> bit-size - the size, relative to the canvas, of each bit in the bitmap. A bit-size of 2 will be two units wide and two units high. The bit-size is subject to scaling both by the scaling factor (or x-scaling factor) of the bitmap element, and by the window scaling factor. Default value: 1</font></blockquote>
<p>
<blockquote><font color="#000080"> dot-size** - the final display size of each bit in the bitmap, measured in pixels as output on-screen. Default value: 1</font></blockquote>
<p>
 Section: Summary of the properties of image-maps
<p>
 This section presents a list of the properties associated with both tileset and direct image-maps. Properties which the extension uses internally, and should not be referred to by the author, are marked with a double asterisk (**). All bitmap elements also inherit the properties common to the g-element kind (see above for those properties).
<p>
<blockquote><font color="#000080"> background tint - a glulx color value (see the Glulx Text Effects extension) that defines the color of the background of the image-map. This color will appear wherever a tile is absent, and will also &quot;show through&quot; transparent PNG images. Default value: g-PlaceNullCol (the null color value, meaning no background will be drawn)</font></blockquote>
<p>
<blockquote><font color="#000080"> tiled graphlink status - Whether or not some or all of an image-map's tiles have individual graphic hyperlinks (graphlinks). Can be g-active (accepting input) or g-inactive. Default value: g-inactive</font></blockquote>
<p>
<blockquote><font color="#000080"> linked command array - A list of lists of texts describing the default commands associated with each of the cells in the image-map. Will not be consulted unless tiled graphlink status is g-active. The length and shape of the list should be the same as the length of the image-map's tile-array or figure-array. Default value: { }</font></blockquote>
<p>
<blockquote><font color="#000080"> scaled tile-width** - The width of each tile in screen coordinates, as determined after scaling the canvas and the image-map. Default value: 0</font></blockquote>
<p>
<blockquote><font color="#000080"> scaled tile-height** - The height of each tile in screen coordinates, as determined after scaling the canvas and the image-map. Default value: 0</font></blockquote>
<p>
 Section: Summary of the properties of tileset image-maps
<p>
 This section lists the properties of the tileset image-map that are not shared by other image-map kinds. Tileset image-maps also inherit the properties common to the image-map and the g-element kinds (see above for those properties).
<p>
<blockquote><font color="#000080"> tile-array - A list of lists of numbers, written in brace notation, that defines, in the form of a matrix, the individual images to be used in the image-map. The numbers refer to the translation-table of the associated tileset object. Default value: { }</font></blockquote>
<p>
<blockquote><font color="#000080"> associated tileset - The name of a tileset object. This tileset will be used to render the tile-array. Default value: null tileset</font></blockquote>
<p>
<blockquote><font color="#000080"> tile-width-override - A number that will be used to determine the width (before scaling) of the tiles in the image-map. Overrides any value provided by the associated tileset object. Default value: 0</font></blockquote>
<p>
<blockquote><font color="#000080"> tile-height-override - A number that will be used to determine the height (before scaling) of the tiles in the image-map. Overrides any value provided by the associated tileset object. Default value: 0</font></blockquote>
<p>
 Section: Summary of the properties of direct image-maps
<p>
 This section lists the properties of the direct image-map that are not shared by other image-map kinds. Direct image-maps also inherit the properties common to the image-map and the g-element kinds (see above for those properties).
<p>
<blockquote><font color="#000080"> figure-array - A list of lists of figure names, written in brace notation, that defines, in the form of a matrix, the individual images to be used in the image-map. Default value: { }</font></blockquote>
<p>
<blockquote><font color="#000080"> tile-width - A number defining the width (before scaling) of each tile in the image-map. Default value: 1</font></blockquote>
<p>
<blockquote><font color="#000080"> tile-height - A number defining the height (before scaling) of each tile in the image-map. Default value: 1</font></blockquote>
<p>
 Section: Summary of the properties of rendered strings
<p>
 This section presents a list of the properties associated with rendered strings. Properties which the extension uses internally, and should not be referred to by the author, are marked with a double asterisk (**). All rendered strings also inherit the properties common to the g-element kind (see above for those properties).
<p>
 Note that the alignment property functions differently for rendered strings than for other g-elements. For center-aligned and right-aligned rendered strings, the origin is always located along the upper edge of the element; not at the center or the bottom edge.
<p>
<blockquote><font color="#000080"> associated font - a font object, which is the font that should be used to draw the rendered text element. A bitmap-rendered text must use a bitmap font, and an image-rendered font an image font.</font></blockquote>
<p>
<blockquote><font color="#000080"> text-string - an indexed text containing the string to be rendered by the element. Default value: &quot;&quot; (empty string, no output)</font></blockquote>
<p>
<blockquote><font color="#000080"> tint - a glulx color value (see the Glulx Text Effects extension) that defines the color of the letterforms and cursor of a bitmap-rendered string; defines only the cursor color of an image-rendered string. Default value: g-White</font></blockquote>
<p>
<blockquote><font color="#000080"> background tint - a glulx color value (see the Glulx Text Effects extension) that defines the color of the background of the rendered string element. Will be drawn as a single block of color behind the letterforms. Default value: g-PlaceNullCol (null, no background will appear)</font></blockquote>
<p>
<blockquote><font color="#000080"> text-animation delay - a number defining the number of milliseconds that will be delayed after the drawing of each character of the text-string. Default value: 0</font></blockquote>
<p>
<blockquote><font color="#000080"> cursor - a number defining the position of the cursor in the display of the rendered string. The cursor is only displayed when this property is 0 or higher. The cursor wil placed immediately after the string position; i.e., when cursor is 1, the cursor will be positioned immediately after the first character in the string. Default value: -99 (no cursor displayed)</font></blockquote>
<p>
 Section: Summary of the properties of bitmap-rendered strings
<p>
 This section presents a list of the properties associated with bitmap-rendered strings. These are more or less equivalent to the properties of bitmap elements. Properties which the extension uses internally, and should not be referred to by the author, are marked with a double asterisk (**). All bitmap-rendered strings also inherit the properties common to the g-element and rendered string kinds (see above for those properties).
<p>
<blockquote><font color="#000080"> bit-size - the size, relative to the canvas, of each bit in the bitmaps of the associated font's letterforms. For example, a bit-size of 2 will be two units wide and two units high. The bit-size is subject to scaling both by the scaling factor (or x-scaling factor) of the rendered-string, and by the window scaling factor. Default value: 1</font></blockquote>
<p>
<blockquote><font color="#000080"> dot-size** - the final display size of each bit in the bitmaps of the associated font's letterforms, measured in pixels as output on-screen. Default value: 1</font></blockquote>
<p>
 Section: Summary of the properties of image-rendered strings
<p>
 This section presents a list of the properties associated with image-rendered strings. Properties which the extension uses internally, and should not be referred to by the author, are marked with a double asterisk (**). All image-rendered strings also inherit the properties common to the g-element and rendered string kinds (see above for those properties).
<p>
<blockquote><font color="#000080"> calculated scaling factor** - a real number (decimal with four-digit precision) that represents the scaling factor of both the window and the rendered string element.</font></blockquote>
<p>
 Chapter: Contact info
<p>
 This extension is released under the Creative Commons Attribution licence. Bug reports, feature requests or questions should be made at &lt;https://github.com/i7/extensions/issues&gt;.
<p>
 For questions about Glimmr, please consider posting to either the rec.arts.int-fiction newsgroup or at the intfiction forum (http://www.intfiction.org/forum/). This allows questions to be public, where the answers can also benefit others.
<p>
 Chapter: Change Log
<p>
 Version 4: Updated for 6M62 by Dannii Willis
<p>
 Version 3: Fixed minor bug in the buttons examples.
<p>
 Version 2: Updated for 6F95 (thanks to Harold Gates for his help!). Now uses no deprecated features.
<p>
 Version 1: Initial release.
<p>
 Chapter: Examples
<p>
 A number of examples are included here, showcasing just some of the capabilities of Glimmr. Many of these require external resources (image files), which can be downloaded from http://code.google.com/p/glimmr-i7x/downloads/list. Compiled versions of the examples can also be downloaded, if you prefer to see the final result without compiling yourself.
<p>
 Example: * Simple Buttons - In this example, we show how to create a simple set of buttons that the player can press to issue commands. (We use the most important meta-commands: undo, save, restore, and transcript.) The example requires the Glimmr Image Font extension, and you will need to copy the images associated with that extension to your project's Materials folder before building this example. The example also requires Glimmr Graphic Hyperlinks, which enables the buttons to accept mouse input.
<p>
 We make each button out of two g-elements: a stroked rectangle primitive creates the button's outline and color, while an image-rendered string provides the text of the button. This is convenient, since it doesn't require us to create our own images for each button. (Though using a single image for each button is in fact the most resource-efficient method.)
<p>
 Before we get to the buttons, we need to set up the window and canvas. For an example like this, Glimmr Simple Graphics Window would be an even easier way to set things up, but it's better if we show everything here.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> &quot;Simple Buttons&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Include Glimmr Canvas-Based Drawing by Erik Temple.<br> Include Glimmr Graphic Hyperlinks by Erik Temple.<br> Include Glimmr Image Font by Erik Temple.</font></blockquote>
<p>
<blockquote><font color="#000080"> Hello is a room.</font></blockquote>
<p>
<blockquote><font color="#000080"> The graphics-window is a graphlink g-window spawned by the main-window. The position is g-placebelow. The scale method is g-fixed-size. The measurement is 35. The back-colour is g-White.</font></blockquote>
<p>
<blockquote><font color="#000080"> The back-colour of the main-window is g-White.</font></blockquote>
<p>
<blockquote><font color="#000080"> The graphics-canvas is a g-canvas. The canvas-width is 248. The canvas-height is 35.<br> The associated canvas of the graphics-window is the graphics-canvas.<br> The associated canvas of a g-element is the graphics-canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> When play begins:<br>&nbsp;&nbsp;&nbsp;&nbsp; open up the graphics-window.</font></blockquote>
<p>
<blockquote><font color="#000080"> After printing the banner text:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[line break]This is one of two very similar examples for the Glimmr Canvas-Based Drawing extension. It demonstrates a simple set of UI buttons. The buttons are not sprites. In other words, they are created without the need to make external PNG or JPEG images. Instead, we use Glimmr's functions for easily drawing rectangles and more complex elements. An image-rendered string provides the button's text, and this is superimposed on a stroked rectangle primitive that creates the body of the button. A simple animation allows the button to change color briefly when pressed, to provide visual feedback.[paragraph break]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Common Color Values (continued)</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> glulx color value</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> assigned number</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-LightGray</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 15066597</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-MidGray</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 12829635</font></font></td></tr></table></blockquote>
<p>
 Now we create the buttons. We begin by setting up most of properties using subclasses of the stroked rectangle primitive and image-based string kinds--these are the &quot;button&quot; and &quot;label&quot; kinds. The buttons are primed to accept mouse input by making them graphlink-active. The labels merely float over the button; it is the latter which does all the work.
<p>
 Note that the image-based font is rather large, and we need to scale it down to a quarter of its actual size. Also note that the labels are center-aligned. This isn't necessary, but it does mean that if we change the text of the label slightly, we may be able to avoid changing the origin coordinate, since it will still attempt to center itself over the button background. Finally, we use display-layers to keep the label text, on layer 2, above the button background, on layer 1 (the default layer).
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> A button is a kind of stroked rectangle primitive. The associated canvas of a button is the graphics-canvas. The tint of a button is g-LightGray. The background tint of a button is g-MidGray. The graphlink status of a button is g-active.</font></blockquote>
<p>
<blockquote><font color="#000080"> A label is a kind of image-rendered string. The associated canvas of a label is the graphics-canvas. The scaling factor of a label is 0.2500. The display-layer of a label is 2. The alignment of a label is center-aligned.</font></blockquote>
<p>
<blockquote><font color="#000080"> A button has a label called the associated label.</font></blockquote>
<p>
<blockquote><font color="#000080"> Some labels are defined by the Table of Button Labels.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Button Labels</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> label</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> origin</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> text-string</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 30, 10 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;Undo&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 81, 10 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;Save&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 138, 10 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;Restore&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 204, 10 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;Transcript&quot;</font></font></td></tr></table></blockquote>
<p>
<blockquote><font color="#000080"> Some buttons are defined by the Table of Glimmr Buttons.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Glimmr Buttons</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> button</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> origin</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> endpoint</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> associated label</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> linked replacement-command</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Button_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 10, 7 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 52, 28 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;UNDO&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Button_2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 61, 7 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 103, 28 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;SAVE&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Button_3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 111, 7 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 165, 28 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;RESTORE&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Button_4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 173, 7 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 238, 28 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;TRANSCRIPT&quot;</font></font></td></tr></table></blockquote>
<p>
 We can include a little optional code to change the color of the button momentarily when it is pressed, then reverting back to the original color. We do this using Glulx's real-time capability: when the button is pressed, we change the button's color, and start a short timer (85 milliseconds). When the timer runs out, we stop the timer and change the button back to the original color. Note that the window must be redrawn after each of these to show the state change to the player.
<p>
 The final line in the block intializes the current graphlink variable to Button_1 (the &quot;undo&quot; button). This is done so that, in the case where the first button pressed by the player is UNDO, the &quot;current graphlink&quot; value will hold a valid g-element (rather than null) after undoing; if the current graphlink doesn't store a button, the timer will go off after the action is undone and try to check the &quot;tint&quot; property of nothing (since the game state will have reverted to before the player pressed the button), resulting in an error.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> To revert the/-- button/-- after (T - a number) millisecond/milliseconds:<br>&nbsp;&nbsp;&nbsp;&nbsp; (-  glk_request_timer_events({T});   -)</font></blockquote>
<p>
<blockquote><font color="#000080"> To stop the/-- timer:<br>&nbsp;&nbsp;&nbsp;&nbsp; (-  glk_request_timer_events(0);  -)</font></blockquote>
<p>
<blockquote><font color="#000080"> First graphlink processing rule for a button (called the depressed):<br>&nbsp;&nbsp;&nbsp;&nbsp; change the tint of the depressed to g-MidGray;<br>&nbsp;&nbsp;&nbsp;&nbsp; follow the window-drawing rules for the graphics-window;<br>&nbsp;&nbsp;&nbsp;&nbsp; revert the button after 85 milliseconds.</font></blockquote>
<p>
<blockquote><font color="#000080"> A glulx timed activity rule (this is the redraw button from timer rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; stop the timer;<br>&nbsp;&nbsp;&nbsp;&nbsp; now the tint of the current graphlink is g-LightGray;<br>&nbsp;&nbsp;&nbsp;&nbsp; follow the window-drawing rules for the graphics-window.</font></blockquote>
<p>
<blockquote><font color="#000080"> The current graphlink is Button_1.</font></blockquote>
<p>
 This last part is even more optional, but it will ensure that the button acts correctly after UNDO. We set the timer to revert immediately after undoing the state of the last turn, to be sure that the buttons end in their resting state. To act after undoing, we either have to directly hack the template layer, or use an extension such as Undo Output Control, which is how we handle it here.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Include Undo Output Control by Erik Temple.</font></blockquote>
<p>
<blockquote><font color="#000080"> After undoing an action:<br>&nbsp;&nbsp;&nbsp;&nbsp; revert the button after 0 milliseconds.</font></blockquote>
<p>
 Example: * Simpler Buttons - This example is a simple refinement of the previous example (Simple Buttons). In Simple Buttons, we had to supply what really was redundant information: the text of the label was the same as the linked replacement-command of its button, while the origin coordinate of the label is easily deducible from the placement and size of the button outline (the label is centered on the button). This example lets us define the labels minimally and auto-generate their text-strings and origin coordinates from their associated buttons. (One could go even farther with this approach, really, but this should be enough to suggest possibilities.)
<p>
 Simpler Buttons also uses a bitmap font for variety's sake. Note that if you make the window too narrow--unplayably narrow, really--the labels will not fit within the button outlines. This is because bitmaps can't be scaled below 1 pixel per bit, while the canvas itself is scaled to much less than this. This is something to be wary of whenever you are using bitmaps.
<p>
 The example starts out in essentially the same way as the previous:
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> &quot;Simpler Buttons&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Include Glimmr Canvas-Based Drawing by Erik Temple.<br> Include Glimmr Graphic Hyperlinks by Erik Temple.<br> Include Glimmr Bitmap Font by Erik Temple.</font></blockquote>
<p>
<blockquote><font color="#000080"> The graphics-window is a graphlink g-window spawned by the main-window. The position is g-placebelow. The scale method is g-fixed-size. The measurement is 35. The back-colour is g-White.</font></blockquote>
<p>
<blockquote><font color="#000080"> The graphics-canvas is a g-canvas. The canvas-width is 248. The canvas-height is 35.<br> The associated canvas of the graphics-window is the graphics-canvas.<br> The associated canvas of a g-element is the graphics-canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> The back-colour of the main-window is g-White.</font></blockquote>
<p>
<blockquote><font color="#000080"> Hello is a room.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Common Color Values (continued)</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> glulx color value</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> assigned number</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-LightGray</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 15066597</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-MidGray</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 12829635</font></font></td></tr></table></blockquote>
<p>
 Now we get to the new stuff. The short loop code that occurs before we open the graphics window sets origin coordinates of the labels by finding the center point of each button, then using that coordinate for the label's origin. We manually change the vertical coordinate for better fit (because the origin of the label is the top line rather than the center, we need to move it up, otherwise it will flow in from the center of the button down, filling up only the lower half of the button background).
<p>
 The text-string is replaced with the linked replacement-command of the button. Note that Inform is very picky about the conversion of text (the linked replacement-command of the button) into indexed text (the text-string of the label). We use a replacement routine to handle this task.
<p>
 Compare the Table of Button Labels here with the one for Simple Buttons--we've been able to reduce the work of label creation to simple naming. (We could avoid even this if we wanted to use Jesse McGrew's Dynamic Objects extension, say, to actually create new label objects as needed to fit our buttons...)
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> When play begins:<br>&nbsp;&nbsp;&nbsp;&nbsp; repeat with item running through buttons:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; let the current-label be the associated label of item;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now the origin of the current-label is the center-point of item;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now entry 2 of the origin of the current-label is 12;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; replace the text &quot;0&quot; in text-string of the current-label with the linked replacement-command of item;<br>&nbsp;&nbsp;&nbsp;&nbsp; open up the graphics-window.</font></blockquote>
<p>
<blockquote><font color="#000080"> A button is a kind of stroked rectangle primitive. The associated canvas of a button is the graphics-canvas. The tint of a button is g-LightGray. The background tint of a button is g-MidGray. The graphlink status of a button is g-active.</font></blockquote>
<p>
<blockquote><font color="#000080"> A label is a kind of bitmap-rendered string. The associated canvas of a label is the graphics-canvas. The scaling factor of a label is 0.2500. The display-layer of a label is 2. The alignment of a label is center-aligned. The tint is g-Dark-Grey. The text-string is &quot;0&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> A button has a label called the associated label.</font></blockquote>
<p>
<blockquote><font color="#000080"> Label_1, Label_2, Label_3, and Label_4 are labels.</font></blockquote>
<p>
<blockquote><font color="#000080"> Some buttons are defined by the Table of Glimmr Buttons.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Glimmr Buttons</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> button</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> origin</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> endpoint</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> associated label</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> linked replacement-command</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Button_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 10, 7 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 52, 28 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;Undo&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Button_2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 61, 7 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 103, 28 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;Save&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Button_3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 111, 7 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 165, 28 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;Restore&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Button_4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 173, 7 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 238, 28 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Label_4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;Transcript&quot;</font></font></td></tr></table></blockquote>
<p>
<blockquote><font color="#000080"> After printing the banner text:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[line break]This is one of two very similar examples for the Glimmr Canvas-Based Drawing extension. It demonstrates a simple set of UI buttons. The buttons are not sprites. In other words, they are created without the need to make an external PNG or JPEG image for each one. Instead, we use Glimmr's functions for easily drawing rectangles and more complex elements. A bitmap-rendered string provides the button's text, and this is superimposed on a stroked rectangle primitive that creates the body of the button. No image files at all are used. A simple animation allows the button to change color briefly when pressed, to provide visual feedback.[paragraph break]&quot;.</font></blockquote>
<p>
 And the (optional) button animations (see the previous example for explanation):
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> To revert the/-- button/-- after (T - a number) millisecond/milliseconds:<br>&nbsp;&nbsp;&nbsp;&nbsp; (-  glk_request_timer_events({T});   -)</font></blockquote>
<p>
<blockquote><font color="#000080"> To stop the/-- timer:<br>&nbsp;&nbsp;&nbsp;&nbsp; (-  glk_request_timer_events(0);  -)</font></blockquote>
<p>
<blockquote><font color="#000080"> A glulx timed activity rule (this is the redraw button from timer rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; stop the timer;<br>&nbsp;&nbsp;&nbsp;&nbsp; now the tint of the current graphlink is g-LightGray;<br>&nbsp;&nbsp;&nbsp;&nbsp; follow the window-drawing rules for the graphics-window.</font></blockquote>
<p>
<blockquote><font color="#000080"> First graphlink processing rule for a button (called the depressed):<br>&nbsp;&nbsp;&nbsp;&nbsp; change the tint of the depressed to g-MidGray;<br>&nbsp;&nbsp;&nbsp;&nbsp; follow the window-drawing rules for the graphics-window;<br>&nbsp;&nbsp;&nbsp;&nbsp; revert the button after 85 milliseconds.</font></blockquote>
<p>
<blockquote><font color="#000080"> The current graphlink is Button_1.</font></blockquote>
<p>
<blockquote><font color="#000080"> Include Undo Output Control by Erik Temple.</font></blockquote>
<p>
<blockquote><font color="#000080"> After undoing an action:<br>&nbsp;&nbsp;&nbsp;&nbsp; revert the button after 0 milliseconds.</font></blockquote>
<p>
 Example: *** Basic Floorplan - Given IF's overwhelming focus on movement through physical space, one of the most likely uses for graphics is maps. At the same time, it is not often that we want to include a static map in the game, since getting the complete map all at once will usually spoil things for the player.
<p>
 This example shows how to construct a floorplan for a multilevel space, in a dynamic way: The map only shows rooms that the player has visited. In other words, the map reveals itself as the player moves through the game.
<p>
 Glimmr includes a set of images that can be used freely for constructing maps of this sort, and this example uses that set. The image files are rather generic, by design, so as to be useful in the widest number of situations. The predominant colors are white and dark gray, but because each tile is essentially monochromatic, the coloring is relatively easy to change using programs like Photoshop or GIMP (the latter is free).
<p>
 The easiest way to use this set of map images is with the Glimmr Canvas Editor extension, which allows you to create a Glulx game file that contains a graphics editor. Place and scale the images as you like them, and the editor will output I7 source code for you. The source code for this example was generated using Glimmr Canvas Editor. (It's been cleaned up slightly, and the Scenario and Associated Rooms with Images sections were added, but otherwise it is fairly representative of the code produced by that resource. The canvas editor is highly recommended for most complex compositions.)
<p>
 On to the code for the example. We begin by including the extension and defining the geography for the map. We have a couple of sprite elements that are asymmetrically scaled, so we use the asymmetrical scaling option. This will require us to provide separate x and y scaling factors for any object that is not scaled at a ratio of 1.0000.
<p>
 The scenario definition is followed by the list of figures. The list of figures should be one of the first things we lay out in our story file, because Inform is very picky about them--they must be defined before they can be mentioned in any other context.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> &quot;Basic Floorplan&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Include Glimmr Canvas-Based Drawing by Erik Temple.<br> Include Glimmr Bitmap Font by Erik Temple.</font></blockquote>
<p>
<blockquote><font color="#000080"> Use asymmetrical scaling.</font></blockquote>
<p>
<blockquote><font color="#000080"> Chapter - Scenario</font></blockquote>
<p>
<blockquote><font color="#000080"> Entrance Chamber is a room. &quot;A stair spirals upward, and there is a doorway in the south wall.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> The heavy door is an open door. &quot;[if the heavy door is open]The heavy wooden door is open.[otherwise]The heavy wooden door is closed.[end if]&quot;. It is south of Entrance Chamber and north of Hall.</font></blockquote>
<p>
<blockquote><font color="#000080"> Guard Room is east of Hall. &quot;An exit leads west.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Up from Entrance Chamber is the Shaft. The description of the Shaft is &quot;The stairs continue up and down, and there is an opening to the south.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Watch Room is south of the Shaft. &quot;You can return to the north.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Up from Shaft is the Upper Chamber. The description of the Upper Chamber is &quot;The stair spirals downward, and a curving passage leads south.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Flanking Chamber is south of Upper Chamber. &quot;The passage leads back to the west.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> North of Flanking Chamber is nowhere. West of Flanking Chamber is Upper Chamber. East of Upper Chamber is nowhere.</font></blockquote>
<p>
<blockquote><font color="#000080"> After printing the banner text:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[paragraph break]This is an example of a dynamic map built using Glimmr Canvas-Based Drawing. It provides a floorplan that reveals itself as the player moves through it. Each room is revealed as the player enters it, and each floor is pictured in a separate pane. A spare icon acts as an avatar for the player, showing the present location in the developing map.[paragraph break]This example was built using the 'Basic Floorplan Toolkit' distributed with Glimmr. The Basic Floorplan Toolkit is an instance of the Glimmr Canvas Editor, a GUI graphics editor that allows you to build a composition graphically and output I7 source code describing it. Basic Floorplan Toolkit includes a set of images designed for use in creating simple floorplans in the style of those used by Emily Short in her pdf map for [i]Bronze[/i] (chosen as a model because of the manifest popularity of the style).[paragraph break]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> Chapter - Figure Definitions</font></blockquote>
<p>
<blockquote><font color="#000080"> Figure of Orthogonal Room Square is the file &quot;Orthogonal Room Square.png&quot;.<br> Figure of Orthogonal Room Horizontal is the file &quot;Orthogonal Room Horizontal.png&quot;.<br> Figure of Orthogonal Room Vertical is the file &quot;Orthogonal Room Vertical.png&quot;.<br> Figure of Orthogonal Room Round is the file &quot;Orthogonal Room Round.png&quot;.<br> Figure of Orthogonal Room Hexagonal is the file &quot;Orthogonal Room Hexagonal.png&quot;.<br> Figure of Orthogonal Hall Horizontal is the file &quot;Orthogonal Hall Horizontal.png&quot;.<br> Figure of Orthogonal Hall Vertical is the file &quot;Orthogonal Hall Vertical.png&quot;.<br> Figure of Orthogonal Hall NW to SE is the file &quot;Orthogonal Hall NW to SE.png&quot;.<br> Figure of Orthogonal Hall SW to NE is the file &quot;Orthogonal Hall SW to NE.png&quot;.<br> Figure of Orthogonal Long Hall NW to SE is the file &quot;Orthogonal Long Hall NW to SE.png&quot;.<br> Figure of Orthogonal Long Hall SW to NE is the file &quot;Orthogonal Long Hall SW to NE.png&quot;.<br> Figure of Orthogonal Curve N to E is the file &quot;Orthogonal Curve N to E.png&quot;.<br> Figure of Orthogonal Curve S to E is the file &quot;Orthogonal Curve S to E.png&quot;.<br> Figure of Orthogonal Curve W to N is the file &quot;Orthogonal Curve W to N.png&quot;.<br> Figure of Orthogonal Curve W to S is the file &quot;Orthogonal Curve W to S.png&quot;.<br> Figure of Rough Room Square 01 is the file &quot;Rough Room Square 01.png&quot;.<br> Figure of Rough Room Square 02 is the file &quot;Rough Room Square 02.png&quot;.<br> Figure of Rough Room Horizontal is the file &quot;Rough Room Horizontal.png&quot;.<br> Figure of Rough Room Vertical is the file &quot;Rough Room Vertical.png&quot;.<br> Figure of Rough Room Circular is the file &quot;Rough Room Circular.png&quot;.<br> Figure of Rough Hall Horizontal is the file &quot;Rough Hall Horizontal.png&quot;.<br> Figure of Rough Hall Vertical is the file &quot;Rough Hall Vertical.png&quot;.<br> Figure of Rough Hall NW to SE is the file &quot;Rough Hall NW to SE.png&quot;.<br> Figure of Rough Hall SW to NE is the file &quot;Rough Hall SW to NE.png&quot;.<br> Figure of Rough Long Hall Horizontal is the file &quot;Rough Long Hall Horizontal.png&quot;.<br> Figure of Rough Long Hall Vertical is the file &quot;Rough Long Hall Vertical.png&quot;.<br> Figure of Rough Long Hall NW to SE is the file &quot;Rough Long Hall NW to SE.png&quot;.<br> Figure of Rough Long Hall SW to NE is the file &quot;Rough Long Hall SW to NE.png&quot;.<br> Figure of Rough Curve N to E is the file &quot;Rough Curve N to E.png&quot;.<br> Figure of Rough Curve S to E is the file &quot;Rough Curve S to E.png&quot;.<br> Figure of Rough Curve W to N is the file &quot;Rough Curve W to N.png&quot;.<br> Figure of Rough Curve W to S is the file &quot;Rough Curve W to S.png&quot;.<br> Figure of Door Horizontal is the file &quot;Door Horizontal.png&quot;.<br> Figure of Door NE to SW is the file &quot;Door NE to SW.png&quot;.<br> Figure of Door NW to SE is the file &quot;Door NW to SE.png&quot;.<br> Figure of Door Vertical is the file &quot;Door Vertical.png&quot;.<br> Figure of Stair Circular is the file &quot;Stair Circular.png&quot;.<br> Figure of Stair Horizontal is the file &quot;Stair Horizontal.png&quot;.<br> Figure of Stair Vertical is the file &quot;Stair Vertical.png&quot;.<br> Figure of Occluder Square is the file &quot;Occluder Square.png&quot;.<br> Figure of Player Icon is the file &quot;Player Icon.png&quot;.<br> Figure of Player Icon Alternate is the file &quot;Player Icon2.png&quot;.</font></blockquote>
<p>
 Next we define our graphics window and its accompanying canvas. For other examples, we will simply use the Glimmr Simple Graphics Window extension, but here we want to illustrate each step completely.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Chapter - Graphics window</font></blockquote>
<p>
<blockquote><font color="#000080"> The graphics-window is a graphics g-window spawned by the main-window. The position of the graphics-window is g-placeabove. The measurement of the graphics-window is 50. The back-colour of the graphics-window is g-black.</font></blockquote>
<p>
<blockquote><font color="#000080"> The graphics-window canvas is a g-canvas. The canvas-width is 500. The canvas-height is 300. The associated canvas of the graphics-window is graphics-window canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> When play begins:<br>&nbsp;&nbsp;&nbsp;&nbsp; open up the graphics-window.</font></blockquote>
<p>
 The next block of code is short but crucial--it controls the revelation of the map, and also places the PC's avatar in the proper position on screen.
<p>
 Our set of sprites is designed so that multiple elements may be needed to make up a room; for example, our Entrance Chamber includes a squarish shape for the room outline, a short hallway, a spiral staircase, and a door. Each of these is a separate sprite, but we need them all to be &quot;turned on&quot; at the same time when the player enters that room for the first time.
<p>
 The way we do this is by assigning a room to each sprite, its &quot;associated room&quot; property. Whenever we need to update the displayed map, we repeat through the inactive (undisplayed) elements and, if the location matches its associated room, we mark that element as active.
<p>
 We then update the screen position of the player's avatar by looking up the location in the Table of Avatar Coordinates and using the x, y pair we find there.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Chapter - Associating rooms with elements</font></blockquote>
<p>
<blockquote><font color="#000080"> A g-element has a room called the associated room.</font></blockquote>
<p>
<blockquote><font color="#000080"> The update map sprites rule is listed in the carry out looking rules.</font></blockquote>
<p>
<blockquote><font color="#000080"> This is the update map sprites rule:<br>&nbsp;&nbsp;&nbsp;&nbsp; repeat with current-element running through display-inactive g-elements:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the associated room of current-element is the location:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; activate current-element;<br>&nbsp;&nbsp;&nbsp;&nbsp; if there is a locale of the location in the Table of Avatar Coordinates:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; choose row with a locale of the location in the Table of Avatar Coordinates;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; change the origin of the PC avatar to the coord entry;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; activate PC avatar;<br>&nbsp;&nbsp;&nbsp;&nbsp; follow the window-drawing rules for graphics-window.</font></blockquote>
<p>
 Next we divide the basic elements into sub-classes, such as rooms, movable objects, etc. This makes it easier to keep track of them. For ease of use, we define the elements using tables; this is less verbose than defining them in sentences.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Section - Room-element sprites</font></blockquote>
<p>
<blockquote><font color="#000080"> A room-element is a kind of sprite. The graphlink status of a room-element is g-inactive. The associated canvas of a room-element is graphics-window canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> Some room-elements are defined by the Table of Room-element Elements.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Room-Element Elements</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> room-element</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> origin</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> image-ID</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> display-layer</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> display status</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> x-scaling factor</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> y-scaling factor</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> associated room</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Horizontal_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 63, 89 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Horizontal</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-active</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Entrance Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Round_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 87, 112 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Round</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-active</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Entrance Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Stair_Circular_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 95, 121 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Stair Circular</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-active</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.7000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.7000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Entrance Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Hall_Vertical_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 68, 131 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Hall Vertical</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-active</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Entrance Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Vertical_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 65, 149 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Vertical</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.4167</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.9722</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Hall</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Square_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 96, 168 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Square</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.8000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.8000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Guard Room</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Hall_Horizontal_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 80, 182 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Hall Horizontal</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Hall</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Round_2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 232, 108 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Round</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Shaft</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Stair_Circular_2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 239, 116 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Stair Circular</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.7000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.7000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Shaft</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Hall_Vertical_2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 250, 152 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Hall Vertical</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Shaft</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Horizontal_2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 208, 167 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Horizontal</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Watch Room</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Horizontal_1_copy</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 363, 89 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Horizontal</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Upper Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Round_1_copy</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 387, 112 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Round</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Upper Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Stair_Circular_1_copy</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 395, 121 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Stair Circular</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.7000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.7000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Upper Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Door_Horizontal_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 68, 141 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Door Horizontal</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-active</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0000</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Entrance Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Curve_N_to_E_1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 362, 135 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Curve N to E</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.0556</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.3056</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Upper Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Square_2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 394, 165 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Square</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.7917</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1.1250</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Flanking Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Orthogonal_Room_Square_3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 365, 188 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Orthogonal Room Square</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.6500</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.6500</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Flanking Chamber</font></font></td></tr></table></blockquote>
<p>
<blockquote><font color="#000080"> Section - Movable-element sprites</font></blockquote>
<p>
<blockquote><font color="#000080"> A movable-element is a kind of sprite. The graphlink status of a movable-element is g-inactive. The associated canvas of a movable-element is graphics-window canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> Some movable-elements are defined by the Table of Movable-element Elements.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Movable-Element Elements</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> movable-element</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> origin</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> image-ID</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> display-layer</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> display status</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> x-scaling factor</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> y-scaling factor</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> associated room</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> PC Avatar</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 69, 95 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Player Icon</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 5</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-active</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.4500</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 0.4500</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Entrance Chamber</font></font></td></tr></table></blockquote>
<p>
 We have a couple of types of objects that are not sprites. Rectangle primitives are used as backdrops to each floor of the tower, and bitmap-rendered strings are used to label each level with a text legend. Because the map is simple, we can know which room to use to turn these features on, and we use the same system used for other shapes. With a more complex map, we would have to treat these regional entities separately.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Section - Backcloth rectangle primitives</font></blockquote>
<p>
<blockquote><font color="#000080"> A backcloth is a kind of rectangle primitive. The graphlink status of a backcloth is g-inactive. The associated canvas of a backcloth is graphics-window canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> Some backcloths are defined by the Table of Backcloth Elements.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Backcloth Elements</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> backcloth</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> origin</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> endpoint</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> tint</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> display status</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> associated room</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Ground_level</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 32, 57 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 169, 245 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-dark-grey</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-active</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Entrance Chamber</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Shaft_level</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 182, 57 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 319, 245 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-dark-grey</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Shaft</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Upper_level</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 332, 57 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 469, 245 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-dark-grey</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-inactive</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Upper Chamber</font></font></td></tr></table></blockquote>
<p>
<blockquote><font color="#000080"> Section - Title-text bitmap-rendered strings</font></blockquote>
<p>
<blockquote><font color="#000080"> A title-text is a kind of bitmap-rendered string. The graphlink status of a title-text is g-inactive. The associated canvas of a title-text is graphics-window canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> Ground_level_1 is a title-text. The origin is { 39, 63 }. The text-string is &quot;Ground level&quot;. The associated font is Glimmr C&amp;C. Ground_level_1 is left-aligned. The tint is g-medium-grey. The background tint is g-placenullcol. The display-layer is 2. The associated room of Ground_level_1 is Entrance Chamber.</font></blockquote>
<p>
<blockquote><font color="#000080"> Shaft_2 is a title-text. The origin is { 189, 63 }. The text-string is &quot;Shaft&quot;. The associated font is Glimmr C&amp;C. Shaft_2 is left-aligned. The tint is g-medium-grey. The background tint is g-placenullcol. The display-layer is 2. The display status of Shaft_2 is g-inactive. The associated room of Shaft_2 is Shaft.</font></blockquote>
<p>
<blockquote><font color="#000080"> Upper_level_3 is a title-text. The origin is { 341, 63 }. The text-string is &quot;Upper level&quot;. The associated font is Glimmr C&amp;C. Upper_level_3 is left-aligned. The tint is g-medium-grey. The background tint is g-placenullcol. The display-layer is 2. The display status of Upper_level_3 is g-inactive. The associated room of Upper_level_3 is Upper Chamber.</font></blockquote>
<p>
 Finally, the table that converts the location to the coordinates that the player's avatar should have onscreen. (These were mapped using Glimmr Canvas Editor's &quot;instances&quot; feature.)
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Chapter - The Avatar's destinations</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Avatar Coordinates</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> locale</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> coord</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Hall</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 66, 173 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Guard Room</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 105, 176 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Shaft</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 238, 122 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Watch Room</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 233, 180 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Upper Chamber</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 373, 99 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Flanking Chamber</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 395, 186 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Entrance Chamber</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 71, 96 }</font></font></td></tr></table></blockquote>
<p>
 Example: ** Wandering Rhodes - We want to show the player's location on a map, but the full map is so large that it leaves us unable to see details. This example explores one solution to this problem, displaying the full map in one graphics window, and showing a detail view, an inset, in a second window.
<p>
 This example illustrates one way to do this, by displaying the same canvas in two different windows, with each window having different framing parameters. We have a larger graphics window on the left, displaying the full map, scaled to fit in the window. A smaller window on the right displays a close-up of the map, centered on the player's location.
<p>
 Because this by itself is too easy, we also provide the ability to &quot;TOGGLE&quot; between two means of showing the player's location: a placemarker, a la Google Maps, and a box on the full map that marks the area shown in the inset view. The latter will also serve to illustrate how we can dynamically resize elements based on the size of our windows.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> &quot;Wandering Rhodes&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Include Glimmr Canvas-Based Drawing by Erik Temple.</font></blockquote>
<p>
<blockquote><font color="#000080"> Figure of Rhodes is the file &quot;Rhodes.jpg&quot;.<br> Figure of Placemark is the file &quot;Placemark.png&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> The graphics-window is a graphics g-window spawned by the main-window. The measurement of the graphics-window is 50. The position of the graphics-window is g-placeabove. The associated canvas of the graphics-window is the graphics-canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> The graphics-canvas is a g-canvas. The background image of the graphics-canvas is Figure of Rhodes.</font></blockquote>
<p>
 We use the graphics-window to display the full map view, and the dimensions of the graphics-canvas are determined by the map (Figure of Roads, used as the background image of the canvas). We also define the closeup-window, the g-window that will show the inset. Note that we assign the same canvas to the closeup-window as to the main graphics-window. We also set the closeup-window to a scaling factor of 1.0000 (i.e., 100%), so that the map will always be displayed without scaling.
<p>
 We then assign x, y coordinates to each room. These coordinates will determine where the placemarker will be placed, and will also serve as the center of the frame of the closeup-window; that is, we will display the graphics-canvas in the closeup-window such that the window is centered over this point. This is done using the window-framing adjustment activity and the &quot;center the framing...&quot; phrase.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> The closeup-window is a graphics g-window spawned by the graphics-window. The position is g-placeright. The measurement is 25. The associated canvas is graphics-canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> The arbitrary scaling factor of the closeup-window is 1.0000.</font></blockquote>
<p>
<blockquote><font color="#000080"> When play begins:<br>&nbsp;&nbsp;&nbsp;&nbsp; open up graphics-window;<br>&nbsp;&nbsp;&nbsp;&nbsp; open up the closeup-window;</font></blockquote>
<p>
<blockquote><font color="#000080"> After printing the banner text:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[line break]This example for the Glimmr Canvas-Based Drawing extension demonstrates the display of a single canvas in two different windows. The inset window at right shows a detail view of the main map window at left. The main window scales the canvas to fit, while the inset window always displays it at 100% of actual size, zoomed to the specific location shown by the placemarker in the main window.[paragraph break]The placemarker can be toggled between a pointer and a box the same size as the inset: Type TOGGLE at the command line to change it.[paragraph break]&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> A room has a list of numbers called the origin. The origin is usually { 0, 0 }.<br> Some rooms are defined by the Table of Room Origins.</font></blockquote>
<p>
<blockquote><font color="#000080"> For window-framing adjustment of the closeup-window:<br>&nbsp;&nbsp;&nbsp;&nbsp; center the framing of closeup-window on the origin of the location;<br>&nbsp;&nbsp;&nbsp;&nbsp; continue the action.</font></blockquote>
<p>
 We offer the player the choice to display the current location on the map using either a placemarker (a pointer), or a rectangle that reflects the area of the larger map that is displayed in the closeup-window; the former is implemented as a sprite/image, while the latter is a box primitive. As with other maps, we update the status of these primarily in the carry out looking rules, since the looking rules are always consulted when the player moves between rooms. The currently chosen display option is put into a global variable called the placemarker, which we will use to determine how the properties of the element should be updated.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> The associated canvas of a g-element is the graphics-canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> Pointer is a sprite. The image-ID is Figure of Placemark. The pointer is center-aligned.</font></blockquote>
<p>
<blockquote><font color="#000080"> Map Inset is a box primitive. The tint is g-White. The display status is g-inactive. The line-weight is 2.</font></blockquote>
<p>
<blockquote><font color="#000080"> Toggling view is an action applying to nothing. Understand &quot;toggle&quot; or &quot;toggle map&quot; or &quot;toggle placemarker&quot; as toggling view.</font></blockquote>
<p>
<blockquote><font color="#000080"> The placemarker is a g-element variable. The placemarker is the pointer.</font></blockquote>
<p>
<blockquote><font color="#000080"> Carry out toggling view:<br>&nbsp;&nbsp;&nbsp;&nbsp; if the placemarker is the pointer:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now the placemarker is the map inset;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; activate the placemarker;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; deactivate pointer;<br>&nbsp;&nbsp;&nbsp;&nbsp; otherwise:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now the placemarker is the pointer;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; activate the placemarker;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; deactivate map inset;<br>&nbsp;&nbsp;&nbsp;&nbsp; refresh windows;<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;The placemarker will now be displayed [if the placemarker is the pointer]as an image[otherwise]using a box to depict the area displayed in the closeup window[end if].&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Carry out looking:<br>&nbsp;&nbsp;&nbsp;&nbsp; follow the refresh windows rule;<br>&nbsp;&nbsp;&nbsp;&nbsp; continue the action.</font></blockquote>
<p>
 We don't want to display the marker in the closeup-window, so we simply skip it during the drawing sequence for that window (closeup-window placemarker rule). We then use the drawing active elements activity as a hook for calculating the origins (and endpoint) of the placemarker elements. This activity is a good place for this since it is the activity that controls the scaling and drawing of all elements.
<p>
 The calculation for the map inset element, which is the box primitive that outlines on the large map the area displayed in the closeup-window, is more interesting (see the map inset placement rule). This calculation (the map inset placement rule) uses the room coordinates, the dimensions of the canvas, and the dimensions of the closeup-window to calculate the placement and sizing of the map inset. Remember that the origin and endpoint are actually lists of numbers, hence the need to access each entry individually, as seen in the map inset placement rule.
<p>
 Note the use of &quot;continue the action&quot; at the end of each rule. Most of the rules and activities in Canvas-Based Drawing end automatically in success, so we need to provide explicit continuation in order to use the rest of the rulebook. In this case, the drawing the active elements activity needs to go on to actually draw the elements, not just calculate placement.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Element display rule for the placemarker when the current window is the closeup-window (this is the closeup-window placemarker rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; do nothing.</font></blockquote>
<p>
<blockquote><font color="#000080"> For drawing the active elements when the placemarker is the pointer (this is the pointer placement rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; change the origin of the placemarker to the origin of the location;<br>&nbsp;&nbsp;&nbsp;&nbsp; continue the action;</font></blockquote>
<p>
<blockquote><font color="#000080"> For drawing the active elements when the placemarker is the map inset (this is the map inset placement rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; change entry 1 of the origin of the placemarker to (entry 1 of the origin of the location) - ((width of closeup-window) / 2);<br>&nbsp;&nbsp;&nbsp;&nbsp; change entry 2 of the origin of the placemarker to (entry 2 of the origin of the location) - ((height of the closeup-window) / 2);<br>&nbsp;&nbsp;&nbsp;&nbsp; change entry 1 of the endpoint of the placemarker to (entry 1 of the origin of placemarker) + (width of closeup-window);<br>&nbsp;&nbsp;&nbsp;&nbsp; change entry 2 of the endpoint of the placemarker to (entry 2 of the origin of placemarker) + (height of closeup-window);<br>&nbsp;&nbsp;&nbsp;&nbsp; continue the action;</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Room Origins</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> room</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> origin</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> West Tower</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 108, 221 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> East End of Tower Street</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 356, 292 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> West End of Tower Street</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 211, 280 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Port Fortress</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 412, 415 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Bell Tower</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 585, 204 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> North Tower</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 667, 135 }</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Main Square</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 447, 355 }</font></font></td></tr></table></blockquote>
<p>
<blockquote><font color="#000080"> West End of Tower Street is east of West Tower. East End of Tower Street is east of West End. Main Square is east of East End. Port Fortress is south of Main Square. Bell Tower is north of Main Square. North Tower is north of Bell Tower.</font></blockquote>
<p>
<blockquote><font color="#000080"> The description of a room is &quot;[exits]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> To say exits:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;Exits: &quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; let L be a list of directions;<br>&nbsp;&nbsp;&nbsp;&nbsp; repeat with the way running through directions:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; let place be the room way from location;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if place is a room:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add way to L;<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[L]. &quot;</font></blockquote>
<p>
 Example: ** Roguelike-like - This example uses image-maps and some sprites to create something that looks a lot like a roguelike dungeon-crawler. None of the actual game mechanics one would want in such a game are included, of course, but the basic techniques for display are provided.
<p>
 We use an image-map to display the outline of whatever room we are in. Some of the tiles are graphlinked, so that clicking on the floor of the room will move us one step in the direction clicked, and so that clicking on the exit to a room will take us out of the room. Only the latter takes any time: moving around within a room has no effect on actual gameplay in this example.
<p>
 We wouldn't have a roguelike, though, if all we had was a map. We also need characters that wander over the map. One way we could do this would be to layer multiple image-maps over one another--one map containing the characters, say, and another of the same size representing the base map. An easier method, the one this example employs, is to use sprites for the characters.
<p>
 The tiles used in this example come from a set of tiles known as LoFi Roguelike, by TIGSource user oryx. These are very nice, low-resolution tiles. Each of the tiles is 8 x 8 pixels, but we display them here at 24 by 24. Link to LoFi Roguelike: http://forums.tigsource.com/index.php? topic=8970.0
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> &quot;Roguelike-like&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Include Glimmr Canvas-Based Drawing by Erik Temple.<br> Include Glimmr Graphic Hyperlinks by Erik Temple.<br> Include Glimmr Simple Graphics Window by Erik Temple.</font></blockquote>
<p>
 First we define the tileset. It's often more convenient to put a tileset into its own extension, but we don't have that luxury here, and doing it inline works too.
<p>
 Note the linked command entries in the tileset's translation table. These allow us to specify commands for individual tiles; when we click on these tiles on screen, the associated command will fire. Note that we include 5 versions of the floor tile, one for each of the four directions, and one that is linked with a hyphen. The directional versions are placed at the edge of a room's map, so that clicking on them will move us to the next room. The hyphen link is not issued as a command. We will instead intercept the hyphen link with a special graphlink processing rule (see Glimmr Graphic Hyperlinks) so that we can supply our own behavior later on.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Section - The Tileset</font></blockquote>
<p>
<blockquote><font color="#000080"> LoFi Roguelike is a tileset. The translation-table is the Table of Roguelike Tiles. The tile-width is 24. The tile-height is 24.</font></blockquote>
<p>
<blockquote><font color="#000080"> Figure of Bowman is the file &quot;Bowman.png&quot;.<br> Figure of Floor is the file &quot;Floor.png&quot;.<br> Figure of Manticore is the file &quot;Manticore.png&quot;.<br> Figure of Stairs Up is the file &quot;Stairs Up.png&quot;.<br> Figure of Stairs Down is the file &quot;Stairs Down.png&quot;.<br> Figure of Table is the file &quot;Table.png&quot;.<br> Figure of Torch Wall is the file &quot;Wall with Torch.png&quot;.<br> Figure of Wall is the file &quot;Wall.png&quot;.<br> Figure of Vertical Wall is the file &quot;Vertical Wall.png&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Roguelike Tiles</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Char</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Tile</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Linked Command</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> number</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> figure-name</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> text</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Wall</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 2</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Floor</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;-&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 3</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Torch Wall</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 4</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Vertical Wall</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 5</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Stairs Up</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;up&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 6</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Stairs Down</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;down&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 7</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Floor</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;north&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 8</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Floor</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;east&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 9</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Floor</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;south&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> 10</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Floor</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;west&quot;</font></font></td></tr></table></blockquote>
<p>
<blockquote><font color="#000080"> Section - The Graphics Window</font></blockquote>
<p>
<blockquote><font color="#000080"> The measurement of the graphics-window is 336.<br> The canvas-width of the graphics-canvas is 336. The canvas-height of the graphics-canvas is 336.</font></blockquote>
<p>
<blockquote><font color="#000080"> When play begins:<br>&nbsp;&nbsp;&nbsp;&nbsp; follow the update dungeon map rule;<br>&nbsp;&nbsp;&nbsp;&nbsp; open up the graphics-window.</font></blockquote>
<p>
<blockquote><font color="#000080"> After printing the banner text:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[line break]This imitation of a roguelike game is an example for the Glimmr Canvas-Based Drawing extension. It features an image-map element that displays the map base for each room, using regular graphic tiles from a tileset known as LoFi Roguelike, by TIGSource user oryx (http://forums.tigsource.com/index.php?topic=8970.0). The character icons are borrowed from the the same tileset, and are implemented in Glimmr as sprite objects.[paragraph break]Click on the floor of the room to move toward the location clicked. Click on the furthest floor tile of a map exit to move to the next room. Click on the player's avatar (the archer) to take inventory, or click on an enemy to attack it.[paragraph break]&quot;</font></blockquote>
<p>
 Sprites are displayed using the coordinate system of the canvas, but the characters we are using them to display will need to move according to the internal grid of our image-map. We handle this by giving the sprite a second set of coordinates that we will use for calculating the character's position on the map. We convert this coordinate to canvas coordinates (based on the current position of the image-map on the canvas) before scaling and drawing a sprite. This is the &quot;convert origin coordinate&quot; rule below, and it utilizes one of the phrases that GCBD provides for converting between canvas, screen, and image-map coordinate systems; see the section on image-maps in the documentation above for more.
<p>
 We want each room to have its own independent map, but there is no reason to create a different image-map element for each room. Instead, we have just one image-map object, the Dungeon Map. We assign each room a tile-array, and change the tile-array of the Dungeon Map to reflect the tile-array of the location.
<p>
 At the same time, we also ensure that the appropriate characters are visible. Each character in the game (there are only two, the player and the beast at the end of his quest) has an associated sprite. Whenever we need to redraw the map--as usual, we do this in the looking rules--we activate the characters he can see and deactivate the ones he can't.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Section - Element display and updating</font></blockquote>
<p>
<blockquote><font color="#000080"> Element scaling rule for a character-sprite (called the character) (this is the convert origin coordinate rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; now the origin of the character is the canvas coordinate equivalent of the grid-coordinate of the character in the coordinates of the the dungeon map;<br>&nbsp;&nbsp;&nbsp;&nbsp; continue.</font></blockquote>
<p>
<blockquote><font color="#000080"> The convert origin coordinate rule is listed before the element origin scaling rule in the element scaling rules.</font></blockquote>
<p>
<blockquote><font color="#000080"> A room has a list of lists of numbers called the tile-array. A room has a list of numbers called the initial grid coordinate.</font></blockquote>
<p>
<blockquote><font color="#000080"> Carry out looking:<br>&nbsp;&nbsp;&nbsp;&nbsp; follow the update dungeon map rule;<br>&nbsp;&nbsp;&nbsp;&nbsp; follow the window-drawing rules for the graphics-window.</font></blockquote>
<p>
<blockquote><font color="#000080"> This is the update dungeon map rule:<br>&nbsp;&nbsp;&nbsp;&nbsp; now the tile-array of the Dungeon Map is the tile-array of the location;<br>&nbsp;&nbsp;&nbsp;&nbsp; construct graphic hyperlinks array for the the dungeon map;<br>&nbsp;&nbsp;&nbsp;&nbsp; now the grid-coordinate of the character of the player is the initial grid coordinate of the location;<br>&nbsp;&nbsp;&nbsp;&nbsp; repeat with P running through people:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if P can be seen by the player:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mark the character of P for display;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; otherwise:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; deactivate the character of P.</font></blockquote>
<p>
<blockquote><font color="#000080"> Section - Image-map and Sprites</font></blockquote>
<p>
<blockquote><font color="#000080"> The dungeon map is a tileset image-map. The associated tileset is LoFi Roguelike. The origin is { 24, 24 }. The tiled graphlink status of the dungeon map is g-active.</font></blockquote>
<p>
<blockquote><font color="#000080"> A character-sprite is a kind of sprite. A character-sprite has a list of numbers called the grid-coordinate. The display-layer of a character-sprite is 3. The graphlink status of a character-sprite is g-active. The display status of a character-sprite is g-inactive.</font></blockquote>
<p>
<blockquote><font color="#000080"> A person has a character-sprite called the character.</font></blockquote>
<p>
<blockquote><font color="#000080"> Some character-sprites are defined by the Table of Characters.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Characters</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> character-sprite</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> image-ID</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> grid-coordinate</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> linked replacement-command</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Bowman-sprite</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Bowman</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 4, 4 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;inventory&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Manticore-sprite</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> Figure of Manticore</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> { 5, 7 }</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;attack manticore&quot;</font></font></td></tr></table></blockquote>
<p>
 The next section contains the scenario and is fairly simple. We assign the character-sprites to our characters, and we also set the player's sprite to be active from the start.
<p>
 We then define the rooms and other behavior. Note that each room has an image-map, and that we can use line breaks within the list to make it more or less human-readable.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Section - Scenario</font></blockquote>
<p>
<blockquote><font color="#000080"> The player carries a bow and an arrow. The character of the player is the Bowman-sprite. The display status of the Bowman-sprite is g-active.</font></blockquote>
<p>
<blockquote><font color="#000080"> The Entrance is a room. &quot;A dry and dusty room. A passage leads east, and crumbling stairs lead back to the cave above.&quot; The tile-array is {<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 4, 1, 3, 1, 1, 3, 1, 4, 0, 0, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 4, 2, 2, 2, 2, 2, 2, 4, 0, 0, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 4, 2, 2, 2, 2, 2, 2, 1, 1, 1, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 4, 5, 2, 2, 2, 2, 2, 2, 2, 8, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 4, 2, 2, 2, 2, 2, 2, 4, 1, 1, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 4, 2, 2, 2, 2, 2, 2, 4, 0, 0, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 4, 2, 2, 2, 2, 2, 2, 4, 0, 0, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0 }<br> }. The initial grid coordinate is { 6, 4 }.</font></blockquote>
<p>
<blockquote><font color="#000080"> Instead of going up in the Entrance:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;But your adventure has only just begun, you rogue!&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> The Passage is east of the Entrance. &quot;A narrow passage that turns toward the south, where it widens.&quot; The tile-array is {<br>&nbsp;&nbsp;&nbsp;&nbsp; { 00, 00, 00, 00, 00, 00, 00, 00, 00, 00, 00, 00 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 00, 00, 00, 00, 00, 00, 00, 00, 00, 00, 00, 00 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 00, 01, 01, 01, 01, 01, 01, 01, 01, 04, 00, 00 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 00, 10, 02, 02, 02, 02, 02, 02, 02, 04, 00, 00 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 00, 01, 01, 01, 01, 01, 01, 04, 02, 02, 04, 00 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 00, 00, 00, 00, 00, 00, 00, 04, 02, 02, 04, 00 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 00, 00, 00, 00, 00, 00, 00, 04, 02, 02, 04, 00 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 00, 00, 00, 00, 00, 00, 00, 04, 02, 02, 04, 00 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 00, 00, 00, 00, 00, 00, 00, 04, 09, 09, 04, 00 }<br> }. The initial grid coordinate is { 9, 4 }.</font></blockquote>
<p>
<blockquote><font color="#000080"> The Den of the Beast is south of the Passage. &quot;A large room that nevertheless feels close and fetid. The great Manticore lurks here.&quot; The tile-array is {<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 0, 0, 0, 0, 0, 0, 4, 7, 7, 4, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 0, 0, 0, 0, 0, 0, 4, 2, 2, 4, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 4, 1, 1, 1, 1, 1, 1, 1, 2, 2, 1, 4 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 0, 4, 2, 2, 2, 2, 2, 2, 2, 4, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 0, 4, 2, 2, 2, 2, 2, 2, 2, 4, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 0, 4, 2, 2, 2, 2, 2, 2, 2, 4, 0 },<br>&nbsp;&nbsp;&nbsp;&nbsp; { 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0 }<br> }. The initial grid coordinate is { 9, 3 }.</font></blockquote>
<p>
<blockquote><font color="#000080"> Check going north from the Den:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;If you flee now, you will never be able to face yourself again.&quot; instead.</font></blockquote>
<p>
<blockquote><font color="#000080"> Every turn while the player is in the Den:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[one of]The Manticore roars[or]A snort echoes through the chamber. The Manticor shakes its mane[or]The Manticore stares at you. You feel that your impudence is truly epic[or]The spiked pad at the end of the Manticore's tail sways lazily over the beast's back[purely at random].&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> The Manticore is an animal in the Den. &quot;The Manticore stirs. His eyes lock on yours.&quot; The character is the Manticore-sprite. The description is &quot;More fearsome than the villagers said. A massive catlike creature. Its tail is studded with large, deadly spikes.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Understand &quot;shoot [something]&quot; as attacking.</font></blockquote>
<p>
<blockquote><font color="#000080"> Instead of attacking the Manticore:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;As you nock one of your spindly arrows, you realize just how foolish you have been. Before you can draw back the bowstring, the Manticore's tail stiffens and a shower of deadly spikes arcs toward you.&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; end the story finally.</font></blockquote>
<p>
<blockquote><font color="#000080"> Every turn when the player is in the Den:<br>&nbsp;&nbsp;&nbsp;&nbsp; if the player has been in the Den for three turns and the current action is not the action of attacking the manticore:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say &quot;The Manticore has evidently tired of your dithering. He crouches low and, before you can fit your arrow, he flings a barrage of spikes from his tail.&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end the story finally.</font></blockquote>
<p>
 Finally, we have a couple of things we want to do with mouse input. Since all of our mouse input is game-related--we move the player, take inventory, attack monsters, etc.--we don't want to continue issuing commands if the player is dead. To do this, we make the first graphlink processing rule a check of whether the story is still active. The odd phrasing of the condition reflects a weakness in the Standard Rules' phraseology.
<p>
 More interesting is the handle movement rule. This rule moves the player's avatar in response to mouse clicks on the map. If the player has clicked on the Dungeon Map, we check to see what command was triggered by the click. If that command was &quot;-&quot;, we know that the player has clicked on a floor tile. We then convert the coordinates of the mouse input from screen coordinates to the coordinates of the image-map. We compare those coordinates with the coordinates of the player, and move the player one step horizontally and/or one step vertically toward the clicked coordinate.
<p>
 You will notice that this rule doesn't do any collision checking--what happens if the player moves over a wall, or on top of the Manticore? This example game is set up so that this is impossible. The player will die before he reaches the Manticore, and because the walls are always at the edge of the map and are not themselves graphlinked, the player can never reach them by clicking. In a real game, we'd need a full system of collision detection, but this sleight of hand suffices for a short example like this one.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Section - Mouse movement</font></blockquote>
<p>
<blockquote><font color="#000080"> First graphlink processing rule when not the story has not ended:<br>&nbsp;&nbsp;&nbsp;&nbsp; rule fails.</font></blockquote>
<p>
<blockquote><font color="#000080"> A graphlink processing rule for the Dungeon Map when the candidate replacement command is &quot;-&quot; (this is the handle movement rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; now the candidate replacement command is &quot;&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; let L be a list of numbers;<br>&nbsp;&nbsp;&nbsp;&nbsp; let L be { 0, 0 };<br>&nbsp;&nbsp;&nbsp;&nbsp; now entry 1 of L is current graphlink x;<br>&nbsp;&nbsp;&nbsp;&nbsp; now entry 2 of L is current graphlink y;<br>&nbsp;&nbsp;&nbsp;&nbsp; let L be the equivalent of screen coordinate L in the coordinates of the Dungeon Map;<br>&nbsp;&nbsp;&nbsp;&nbsp; if entry 1 of L is greater than entry 1 of the grid-coordinate of the Bowman-sprite:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increase entry 1 of the grid-coordinate of the Bowman-sprite by 1;<br>&nbsp;&nbsp;&nbsp;&nbsp; otherwise if entry 1 of L is less than entry 1 of the grid-coordinate of the Bowman-sprite:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; decrease entry 1 of the grid-coordinate of the Bowman-sprite by 1;<br>&nbsp;&nbsp;&nbsp;&nbsp; if entry 2 of L is greater than entry 2 of the grid-coordinate of the Bowman-sprite:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increase entry 2 of the grid-coordinate of the Bowman-sprite by 1;<br>&nbsp;&nbsp;&nbsp;&nbsp; otherwise if entry 2 of L is less than entry 2 of the grid-coordinate of the Bowman-sprite:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; decrease entry 2 of the grid-coordinate of the Bowman-sprite by 1;<br>&nbsp;&nbsp;&nbsp;&nbsp; follow the window-drawing rules for the graphics-window;<br>&nbsp;&nbsp;&nbsp;&nbsp; rule succeeds.</font></blockquote>
<p>
 Example: *** Deal Me In - This example illustrates a number of different techniques. We show how to change the contents of a graphics window at a stroke by changing canvases. We also construct a custom graphic element with rather complex behavior: rather than simply drawing a single entity, the element acts as a manager, interpreting and drawing game information using varied techniques, as needed.
<p>
 Specifically, the manager renders the cards that the player has drawn in a sort of card game (we borrow the relevant code from the Tilt 3 example in the Inform documentation). The game is poker, so the player can hold up to five cards. The manager centers and spaces the card outlines as needed (based on the width of the graphics window). For each card the player holds, it provides a white background, paints text to the window to represent the card's value (e.g., 6, 7, 10, J, Q, K), and draws a bitmap graphic in the proper color to represent the suit. If the player holds fewer than five cards, the remaining cards will be depicted as empty placeholders.
<p>
 The manager g-element also implements simple mouse input: clicking on a placeholder draws a card, while clicking on a card discards it.
<p>
 We begin by defining the graphics window. We give it a fixed height dimension so that the look doesn't vary overmuch, and make it black so that--in most interpreters--it will blend visually with the status line. We also indicate that the window should be refreshed at the end of every turn. We also declare a canvas for card-display. Later, we will declare a second canvas.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> &quot;Deal Me In&quot; by Erik Temple</font></blockquote>
<p>
<blockquote><font color="#000080"> Include Glimmr Canvas-Based Drawing by Erik Temple.<br> Include Glimmr Graphic Hyperlinks by Erik Temple.<br> Include Glimmr Bitmap Font by Erik Temple.<br> Include Basic Screen Effects by Emily Short.</font></blockquote>
<p>
<blockquote><font color="#000080"> The graphics-window is a graphlink g-window spawned by the main-window. The position of the graphics-window is g-placeabove. The scale method of the graphics-window is g-fixed-size. The measurement of the graphics-window is 44.</font></blockquote>
<p>
<blockquote><font color="#000080"> The card-display canvas is a g-canvas. The associated canvas of the graphics-window is the card-display canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> The graphics-canvas is a g-canvas.</font></blockquote>
<p>
<blockquote><font color="#000080"> When play begins:<br>&nbsp;&nbsp;&nbsp;&nbsp; open up the graphics-window.</font></blockquote>
<p>
<blockquote><font color="#000080"> Every turn:<br>&nbsp;&nbsp;&nbsp;&nbsp; refresh windows.</font></blockquote>
<p>
 We want our canvases to be the same size as the window for the purposes of this example, so before scaling the canvas to the window at each refresh, we resize the canvas to match the window. (This isn't strictly necessary. We could get very nice output with fixed-size canvases, but making the canvas variable allows us to show how to make the manager element a bit more powerful.)
<p>
 Note the use of the &quot;associated canvas of the graphics-window&quot; --this allows this rule to resize whatever canvas we assign to the window, and will come in handy when we swap out canvases.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Before scaling the graphics-window:<br>&nbsp;&nbsp;&nbsp;&nbsp; change the canvas-width of the associated canvas of the graphics-window to the width of the graphics-window;<br>&nbsp;&nbsp;&nbsp;&nbsp; change the canvas-height of the associated canvas of the graphics-window to the height of the graphics-window;<br>&nbsp;&nbsp;&nbsp;&nbsp; continue the action.</font></blockquote>
<p>
 Now we define the manager g-element. We provide an origin point, but it is really a placeholder. The x-coordinate will be changed by the scaling rule for the element. Because our graphics window is of a fixed height, the y-coordinate will not change (though in principle it could, of course).
<p>
 We also define the dimensions for each card as global variables. We refer only to the variables in the remainder of the source code, so that if we want to adjust things, we need only return to this paragraph and change these variables.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Section 1 - The manager</font></blockquote>
<p>
<blockquote><font color="#000080"> The card-manager is a g-element. The associated canvas is the card-display canvas. The origin is { 0, 4 }. The graphlink status is g-active.</font></blockquote>
<p>
<blockquote><font color="#000080"> The card-x is a number variable. The card-x is 28.<br> The card-y is a number variable. The card-y is 36.</font></blockquote>
<p>
 Each element (or type of element) has both a scaling rule and a display rule. In the scaling rule for the card-manager element, we don't actually do any scaling. (We don't have to, because the height of our graphics window is fixed, and we simply center the cards in the available space horizontally.) Instead, we use the scaling rule as a hook for setting the x-coordinate of the origin properly in order to display the cards as centered in the window. We do this by first changing the x-coordinate (entry 1 in the origin, which is stored as a list of numbers) to the center-point of the window. We then calculate 2.5 card-widths (half of the five card-widths needed to display the five cards) plus 2/3 of a card-width for the total spacing between cards, and subtract this from the center point. This sets the x-coordinate to the leftmost point of the card assemblage.
<p>
 Next, we move on to the element display rule, where most of the real work is done. After sorting the cards into a reasonable order (by calling a rulebook from the Tilt 3 example), we repeat first through the cards held by the player. Starting at the origin point of the card-manager element, we draw two overlapping white filled rectangles, one slightly wider and shorter than the other; this is a computationally inexpensive way of depicting &quot;rounded&quot; corners for the cards. We then draw a bitmap text in the upper left corner of the card in the appropriate color that indicates its rank (1 to 10, J, Q, K, or A), followed by a monochrome bitmap in the lower right corner to indicate the suit. We then set a graphic hyperlink area in the same screen position as the card with the command &quot;Discard.&quot; This command is just a placeholder; the more important thing we do here is identify the graphlink zone using the name of the card. (For the phrases used to draw the various entitites, see the Glimmr Drawing Commands extension.) Finally, we increase the drawing coordinate by the width of one card plus 1/3 of one card for spacing and start the process over with the next card.
<p>
 If the player is holding fewer than 5 cards, we repeat through the number of places remaining. We draw a lavender box (outline) for each empty spot in the player's hand, and hyperlink this with a &quot;Draw&quot; command.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Element scaling rule for the card-manager:<br>&nbsp;&nbsp;&nbsp;&nbsp; change entry 1 of the origin of the card-manager to entry 1 of the center-point of the card-display canvas;<br>&nbsp;&nbsp;&nbsp;&nbsp; let delta-x be (card-x * 2) + (card-x / 2) + (card-x / 3) + (card-x / 3);<br>&nbsp;&nbsp;&nbsp;&nbsp; change entry 1 of the origin of the card-manager to (entry 1 of the origin of the card-manager minus delta-x);</font></blockquote>
<p>
<blockquote><font color="#000080"> Element display rule for the card-manager:<br>&nbsp;&nbsp;&nbsp;&nbsp; let N be 5 minus the number of cards carried by the player;<br>&nbsp;&nbsp;&nbsp;&nbsp; if N &lt; 5:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; follow the hand-ranking rules;<br>&nbsp;&nbsp;&nbsp;&nbsp; let x be entry 1 of the origin of the card-manager;<br>&nbsp;&nbsp;&nbsp;&nbsp; let y be entry 2 of the origin of the card-manager;<br>&nbsp;&nbsp;&nbsp;&nbsp; repeat with flat running through the cards carried by the player:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; draw a rectangle (color g-white) in (current window) from (x + 1) by (y) to (x + card-x - 1) by (y + card-y);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; draw a rectangle (color g-white) in (current window) from (x) by (y + 1) to (x + card-x) by (y + card-y - 1);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; paint bitmap text (color appropriate to the flat) of &quot;[rank of flat as abbreviated value]&quot; in (current window) at (x + 7) by (y + 2) using Glimmr C&amp;C with dot size 1, center-aligned;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; display monochrome bitmap (color appropriate to the flat) in (current window) at (x + card-x) - 12 by (y + card-y) - 12 using (the bitmap-dataset of the flat) with dot size 1 px;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the card-manager is graphlinked:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set a graphlink in the current window identified as the flat from (x) by (y) to (x + card-x) by (y + card-y) as &quot;DISCARD&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increase x by card-x + (card-x / 3);<br>&nbsp;&nbsp;&nbsp;&nbsp; if N &gt; 0:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat with blank running from 1 to N:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; draw a box (color g-lavender) in (current window) from (x) by (y) to (x + card-x) by (y + card-y) with 1 px line-weight, inset;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the card-manager is graphlinked:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set a graphlink in the current window identified as the card-manager from (x) by (y) to (x + card-x) by (y + card-y) as &quot;DRAW&quot;, ignoring redundant links;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increase x by card-x + (card-x / 3).</font></blockquote>
<p>
 When we set the graphic hyperlink zone for cards in the element display rule for a card, we identified that graphlink zone using the name of the card (card placeholders were identified as the card-manager rather than any particular card). When we click on a card, then, we can provide a special graphlink processing rule to handle the mouse input (see the Glimmr Graphic Hyperlinks extension for more on the graphlink processing rules).
<p>
 In this rule, we change the replacement command to refer to the name of the card, e.g. &quot;discard the ten of hearts&quot;.
<p>
 In the next section, we provide phrases to assign the color and bitmap shape appropriate to a given card's suit.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Section 2 - Graphic hyperlink rule for clicking on a card (for use with Glimmr Graphic Hyperlinks by Erik Temple)</font></blockquote>
<p>
<blockquote><font color="#000080"> A graphlink processing rule for a card (called the flat):<br>&nbsp;&nbsp;&nbsp;&nbsp; if the flat is carried by the player:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; let T be indexed text;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; let T be the &quot;[flat]&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; change the candidate replacement command to &quot;[T in upper case]&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; change the glulx replacement command to &quot;DISCARD THE [candidate replacement command]&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; change the candidate replacement command to &quot;&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rule succeeds.</font></blockquote>
<p>
<blockquote><font color="#000080"> Section 3 - Graphic representation of suits</font></blockquote>
<p>
<blockquote><font color="#000080"> To decide which glulx color value is appropriate to (flat - a card):<br>&nbsp;&nbsp;&nbsp;&nbsp; if the suit of the flat is hearts or the suit of the flat is diamonds:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; decide on g-Red;<br>&nbsp;&nbsp;&nbsp;&nbsp; decide on g-Black;</font></blockquote>
<p>
<blockquote><font color="#000080"> To decide which list of lists of numbers is the bitmap-dataset of (flat - a card):<br>&nbsp;&nbsp;&nbsp;&nbsp; if the suit of the flat is hearts:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; decide on {<br> { 0, 0, 1, 0, 0, 0, 1, 0 },<br> { 0, 1, 1, 1, 0, 1, 1, 1 },<br> { 0, 1, 1, 1, 1, 1, 1, 1 },<br> { 0, 0, 1, 1, 1, 1, 1, 0 },<br> { 0, 0, 0, 1, 1, 1, 0, 0 },<br> { 0, 0, 0, 0, 1, 0, 0, 0 }<br> };<br>&nbsp;&nbsp;&nbsp;&nbsp; if the suit of the flat is diamonds:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; decide on {<br> { 0, 0, 0, 0, 1, 0, 0, 0 },<br> { 0, 0, 0, 1, 1, 1, 0, 0 },<br> { 0, 0, 1, 1, 1, 1, 1, 0 },<br> { 0, 1, 1, 1, 1, 1, 1, 1 },<br> { 0, 0, 1, 1, 1, 1, 1, 0 },<br> { 0, 0, 0, 1, 1, 1, 0, 0 },<br> { 0, 0, 0, 0, 1, 0, 0, 0 }<br> };<br>&nbsp;&nbsp;&nbsp;&nbsp; if the suit of the flat is clubs:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; decide on {<br> { 0, 0, 0, 1, 1, 0, 0, 0 },<br> { 0, 0, 1, 1, 1, 1, 0, 0 },<br> { 0, 0, 1, 1, 1, 1, 0, 0 },<br> { 1, 1, 1, 1, 1, 1, 1, 1 },<br> { 1, 1, 1, 0, 0, 1, 1, 1 },<br> { 1, 1, 1, 1, 1, 1, 1, 1 },<br> { 0, 0, 0, 1, 1, 0, 0, 0 },<br> { 0, 0, 1, 1, 1, 1, 0, 0 }<br> };<br>&nbsp;&nbsp;&nbsp;&nbsp; if the suit of the flat is spades:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; decide on {<br> { 0, 0, 0, 1, 1, 0, 0, 0 },<br> { 0, 0, 1, 1, 1, 1, 0, 0 },<br> { 0, 1, 1, 1, 1, 1, 1, 0 },<br> { 1, 1, 1, 1, 1, 1, 1, 1 },<br> { 1, 1, 1, 1, 1, 1, 1, 1 },<br> { 0, 1, 1, 1, 1, 1, 1, 0 },<br> { 0, 0, 0, 1, 1, 0, 0, 0 },<br> { 0, 0, 1, 1, 1, 1, 0, 0 }<br> };</font></blockquote>
<p>
 The player may not be sure what to do in this example, so we offer some help text. For kicks, we'll do this in the graphics window, using a bitmap-rendered string g-element. When the player types &quot;HELP&quot;, we change the associated canvas of the graphics-window temporarily to the graphics-canvas (defined in Glimmr Simple Graphics Window); the graphics-canvas has only one element, the bitmap-rendered string that provides our instructions. While this is displayed, we pause the game using the &quot;wait for any key&quot; phrase. After the keypress, we switch the canvas back to the card-display canvas and refresh the window again.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Section 4 - Changing the canvas</font></blockquote>
<p>
<blockquote><font color="#000080"> Asking for help is an action out of world. Understand &quot;help&quot; as asking for help.</font></blockquote>
<p>
<blockquote><font color="#000080"> After printing the banner text:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[line break]This example for the Glimmr Canvas-Based Drawing extension illustrates a couple of different of techniques:[paragraph break](1) Changing the contents of a window at a stroke by swapping out the canvas (type HELP to see this).[line break](2) The construction of a complex graphic element from a number of parts: the card graphics are composed of two rectangles, a bitmap-rendered text, and a bitmap graphic.[paragraph break]The example is built on top of the Tilt 3 example from the Inform Recipe Book, essentially unchanged but with the graphic display layered on top.[paragraph break]&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;Type HELP for instructions.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Carry out asking for help:<br>&nbsp;&nbsp;&nbsp;&nbsp; change the associated canvas of the graphics-window to the graphics-canvas;<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;Instructions above. Press any key to continue.&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; refresh windows;<br>&nbsp;&nbsp;&nbsp;&nbsp; wait for any key;<br>&nbsp;&nbsp;&nbsp;&nbsp; change the associated canvas of the graphics-window to the card-display canvas;<br>&nbsp;&nbsp;&nbsp;&nbsp; refresh windows.</font></blockquote>
<p>
<blockquote><font color="#000080"> Help text is a bitmap-rendered string. The associated canvas is the graphics-canvas. The origin is { 5, 10 }. The text-string is &quot;Click on a blank to draw a card. Click on a card to discard it.&quot; The tint is g-CornflowerBlue. The bit-size is 2.</font></blockquote>
<p>
<blockquote><font color="#000080"> Test me with &quot;help / draw / draw / draw / draw / draw&quot;</font></blockquote>
<p>
 From this point on, the code does not differ from the Inform documentation's &quot;Tilt 3&quot; example.
<p>
<blockquote><font color="#000080"><img border=0 src=../../../doc_images/paste.png> Section 5 - Colored Output in Two Forms</font></blockquote>
<p>
<blockquote><font color="#000080"> Include Unicode Character Names by Graham Nelson.</font></blockquote>
<p>
<blockquote><font color="#000080"> Rule for printing the name of a card (called target) while grouping together:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[rank of the target as abbreviated value][suit of the target as symbol]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> To say (current suit - a suit) as symbol:<br>&nbsp;&nbsp;&nbsp;&nbsp; if current suit is diamonds, say &quot;[red letters][unicode black diamond suit][default letters]&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; if current suit is spades, say &quot;[unicode black spade suit]&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; if current suit is clubs, say &quot;[unicode black club suit]&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; if current suit is hearts, say &quot;[red letters][unicode black heart suit][default letters]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of User Styles (continued)</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> style name</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> glulx color</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> special-style-1</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> g-red</font></font></td></tr></table></blockquote>
<p>
<blockquote><font color="#000080"> To say red letters: say first custom style.</font></blockquote>
<p>
<blockquote><font color="#000080"> To say default letters: say roman type.</font></blockquote>
<p>
<blockquote><font color="#000080"> Section 6 - Cards</font></blockquote>
<p>
<blockquote><font color="#000080"> Suit is a kind of value. The suits are hearts, clubs, diamonds, and spades. Understand &quot;heart&quot; as hearts. Understand &quot;club&quot; as clubs. Understand &quot;diamond&quot; as diamonds. Understand &quot;spade&quot; as spades.</font></blockquote>
<p>
<blockquote><font color="#000080"> A card is a kind of thing. A card has a suit. A card has a number called rank. Understand the suit property as describing a card. Understand the rank property as describing a card.</font></blockquote>
<p>
<blockquote><font color="#000080"> 52 cards are in the card repository.</font></blockquote>
<p>
<blockquote><font color="#000080"> To say (count - a number) as a card value:<br>&nbsp;&nbsp;&nbsp;&nbsp; choose row count in the Table of Value Names;<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[term entry]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> Rule for printing the name of a card (called target):<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[rank of the target as a card value] of [suit of the target]&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> To say (count - a number) as abbreviated value:<br>&nbsp;&nbsp;&nbsp;&nbsp; choose row count in the Table of Value Names;<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[abbrev entry]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> Table of Value Names</font><br><table border="0" cellspacing="0" cellpadding="0"><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> term</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> value</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> abbrev</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> topic</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;ace&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;1&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;A&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;ace/A&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;deuce&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;2&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;2&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;deuce/two&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;three&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;3&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;3&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;three&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;four&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;4&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;4&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;four&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;five&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;5&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;5&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;five&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;six&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;6&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;6&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;six&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;seven&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;7&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;7&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;seven&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;eight&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;8&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;8&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;eight&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;nine&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;9&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;9&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;nine&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;ten&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;10&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;10&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;ten&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;jack&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;11&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;J&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;jack/knave/J&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;queen&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;12&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;Q&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;queen/Q&quot;</font></td></tr><tr><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;king&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;13&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;K&quot;</font>&nbsp;&nbsp;&nbsp;&nbsp;</font></td><td align="left" valign="top"><font face="lucida grande,geneva,arial,tahoma,verdana,helvetica,helv" size=2><font color="#000080"> &quot;king/K&quot;</font></font></td></tr></table></blockquote>
<p>
<blockquote><font color="#000080"> After reading a command:<br>&nbsp;&nbsp;&nbsp;&nbsp; if the player's command includes &quot;of [suit]&quot;:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while the player's command includes &quot;of&quot;, cut the matched text;<br>&nbsp;&nbsp;&nbsp;&nbsp; repeat through the Table of Value Names:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while the player's command includes topic entry, replace the matched text with value entry.</font></blockquote>
<p>
<blockquote><font color="#000080"> When play begins:<br>&nbsp;&nbsp;&nbsp;&nbsp; reconstitute deck.</font></blockquote>
<p>
<blockquote><font color="#000080"> To reconstitute deck:<br>&nbsp;&nbsp;&nbsp;&nbsp; let current suit be hearts;<br>&nbsp;&nbsp;&nbsp;&nbsp; now every card is in the card repository;<br>&nbsp;&nbsp;&nbsp;&nbsp; while a card is in the card repository:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat with current rank running from 1 to 13:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; let item be a random card in card repository;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; change rank of item to current rank;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; change suit of item to current suit;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now item is in the deck of cards;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; change current suit to the suit after the current suit.</font></blockquote>
<p>
<blockquote><font color="#000080"> Section 7 - The Deck and the Discard Pile</font></blockquote>
<p>
<blockquote><font color="#000080"> The Casino is a room. &quot;Nothing to see here.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> The deck of cards is in the Casino. It is a closed unopenable container. The description is &quot;A standard poker deck.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> The discard pile is a closed unopenable container. The description is &quot;Cards in this game are discarded face-down, so the discard pile is not very interesting to see. All you can observe is that it currently contains [if the number of cards which are in the discard pile is less than ten][the number of cards which are in the discard pile in words][otherwise]about [the rounded number of cards which are in the discard pile in words][end if] card[s].&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> To decide what number is the rounded number of (described set - a description of objects):<br>&nbsp;&nbsp;&nbsp;&nbsp; let N be the number of members of the described set;<br>&nbsp;&nbsp;&nbsp;&nbsp; let R be N divided by 5;<br>&nbsp;&nbsp;&nbsp;&nbsp; let total be R times 5;<br>&nbsp;&nbsp;&nbsp;&nbsp; decide on total.</font></blockquote>
<p>
<blockquote><font color="#000080"> Rule for printing room description details of something: do nothing instead.</font></blockquote>
<p>
<blockquote><font color="#000080"> Section 8 - Drawing and Discarding Actions</font></blockquote>
<p>
<blockquote><font color="#000080"> Understand the commands &quot;take&quot; and &quot;carry&quot; and &quot;hold&quot; and &quot;get&quot; and &quot;drop&quot; and &quot;throw&quot; and &quot;discard&quot; as something new.</font></blockquote>
<p>
<blockquote><font color="#000080"> Understand &quot;take [text]&quot; or &quot;get [text]&quot; or &quot;drop [text]&quot; as a mistake (&quot;Here, you only draw and discard. Nothing else matters at the moment.&quot;).</font></blockquote>
<p>
<blockquote><font color="#000080"> Understand &quot;draw&quot; or &quot;draw card&quot; or &quot;draw a card&quot; as drawing. Drawing is an action applying to nothing. The drawing action has an object called the card drawn.</font></blockquote>
<p>
<blockquote><font color="#000080"> Setting action variables for drawing:<br>&nbsp;&nbsp;&nbsp;&nbsp; change the card drawn to a random card which is in the deck of cards.</font></blockquote>
<p>
<blockquote><font color="#000080"> Check drawing:<br>&nbsp;&nbsp;&nbsp;&nbsp; if the card drawn is nothing, say &quot;The deck is completely depleted.&quot; instead.</font></blockquote>
<p>
<blockquote><font color="#000080"> Check drawing:<br>&nbsp;&nbsp;&nbsp;&nbsp; if the number of cards carried by the player is greater than four,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say &quot;This is a five-card game; you must discard something before drawing anything further.&quot; instead.</font></blockquote>
<p>
<blockquote><font color="#000080"> Carry out drawing:<br>&nbsp;&nbsp;&nbsp;&nbsp; move the card drawn to the player.</font></blockquote>
<p>
<blockquote><font color="#000080"> Report drawing:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;You draw [a card drawn].&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Understand &quot;discard [card]&quot; as discarding. Discarding is an action applying to one thing.</font></blockquote>
<p>
<blockquote><font color="#000080"> Check discarding:<br>&nbsp;&nbsp;&nbsp;&nbsp; if the player does not carry the noun, say &quot;You can only discard cards from your own hand.&quot; instead.</font></blockquote>
<p>
<blockquote><font color="#000080"> Carry out discarding:<br>&nbsp;&nbsp;&nbsp;&nbsp; now the noun is in the discard pile;<br>&nbsp;&nbsp;&nbsp;&nbsp; if the discard pile is not visible, move the discard pile to the location.</font></blockquote>
<p>
<blockquote><font color="#000080"> Report discarding:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;You toss [the noun] nonchalantly onto the discard pile.&quot;</font></blockquote>
<p>
<blockquote><font color="#000080"> Section 9 - Assessing Hands</font></blockquote>
<p>
<blockquote><font color="#000080"> Before listing contents while taking inventory: group cards together.</font></blockquote>
<p>
<blockquote><font color="#000080"> Before grouping together cards:<br>&nbsp;&nbsp;&nbsp;&nbsp; if the number of cards carried by the player is 5:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[run paragraph on]&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; follow the hand-ranking rules;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the rule succeeded, say &quot;[the outcome of the rulebook]&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; otherwise say &quot;some random cards&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the outcome of the rulebook is pair outcome, say &quot; of [rank of the first thing held by the player as a card value]s&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; otherwise:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[number of cards carried by the player in words] assorted cards&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot; (&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> Rule for grouping together cards:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[list hand]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> To say list hand:<br>&nbsp;&nbsp;&nbsp;&nbsp; let chosen card be the first thing held by the player;<br>&nbsp;&nbsp;&nbsp;&nbsp; while chosen card is a card:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say &quot;[chosen card]&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now chosen card is the next thing held after chosen card;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if chosen card is a card, say &quot;-&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> After grouping together cards:<br>&nbsp;&nbsp;&nbsp;&nbsp; say &quot;)&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> The hand-ranking rules is a rulebook. The hand-ranking rules have outcomes royal flush, straight flush, four of a kind, full house, flush, straight, three of a kind, two pairs, pair, high card.</font></blockquote>
<p>
<blockquote><font color="#000080"> The hand-ranking rulebook has a truth state called the flushness.<br> The hand-ranking rulebook has a truth state called the straightness.</font></blockquote>
<p>
<blockquote><font color="#000080"> The hand-ranking rulebook has a number called the pair count.<br> The hand-ranking rulebook has a number called the triple count.<br> The hand-ranking rulebook has a number called the quadruple count.</font></blockquote>
<p>
<blockquote><font color="#000080"> A card can be sorted or unsorted. A card is usually unsorted.</font></blockquote>
<p>
<blockquote><font color="#000080"> Definition: a card is high if its rank is 11 or more.<br> Definition: a card is low if its rank is 4 or less.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the initial sort rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; now every card is unsorted;<br>&nbsp;&nbsp;&nbsp;&nbsp; while the player carries an unsorted card:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; let item be the lowest unsorted card held by the player;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; move item to the player;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now the item is sorted;<br>&nbsp;&nbsp;&nbsp;&nbsp; if sort-debugging is true, say &quot;-- after initial sort: [list hand]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the finding flushness rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; let called suit be the suit of a random card carried by the player;<br>&nbsp;&nbsp;&nbsp;&nbsp; if every card carried by the player is called suit, change flushness to true.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the finding straightness rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; change straightness to true;<br>&nbsp;&nbsp;&nbsp;&nbsp; let N be the rank of the highest card which is carried by the player;<br>&nbsp;&nbsp;&nbsp;&nbsp; repeat with current rank running from N - 4 to N:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; change the test rank to the current rank;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unless the player carries a matching card:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if the current rank is N - 4 and the current rank is 9 and the player carries an ace card, do nothing;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; otherwise change straightness to false.</font></blockquote>
<p>
<blockquote><font color="#000080"> A card can be quadrupled, tripled, paired or uncombined.</font></blockquote>
<p>
<blockquote><font color="#000080"> Test rank is a number that varies. Definition: a card is matching if its rank is the test rank.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the counting multiples rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; now every card is uncombined;<br>&nbsp;&nbsp;&nbsp;&nbsp; repeat with current rank running from 1 to 13:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; change test rank to current rank;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; let N be the number of matching cards held by the player;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if N is 4:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increase the quadruple count by 1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now every matching card held by the player is quadrupled;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if N is 3:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increase the triple count by 1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now every matching card held by the player is tripled;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if N is 2:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; increase the pair count by 1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now every matching card held by the player is paired.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the move aces up unless there's a low straight rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; unless the straightness is true and the lowest card carried by the player is an ace card and the rank of the highest card carried by the player is 5,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now every ace card which is carried by the player is carried by the player;<br>&nbsp;&nbsp;&nbsp;&nbsp; if sort-debugging is true, say &quot;-- after ace movement rule: [list hand]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the move pairs forward rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; while the player carries a paired card:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; let selection be the lowest paired card which is carried by the player;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; move the selection to the player;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now the selection is uncombined;<br>&nbsp;&nbsp;&nbsp;&nbsp; if sort-debugging is true, say &quot;-- after pairs movement: [list hand]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the raise ace pairs rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; if the player carries exactly two ace cards:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat with item running through ace cards which are carried by the player:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; move item to the player;<br>&nbsp;&nbsp;&nbsp;&nbsp; if sort-debugging is true, say &quot;-- after paired-ace movement: [list hand]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the move multiples forward rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; while the player carries a tripled card:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; let selection be the lowest tripled card which is carried by the player;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; move the selection to the player;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now the selection is uncombined;<br>&nbsp;&nbsp;&nbsp;&nbsp; while the player carries a quadrupled card:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; let selection be the lowest quadrupled card which is carried by the player;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; move the selection to the player;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; now the selection is uncombined;<br>&nbsp;&nbsp;&nbsp;&nbsp; if sort-debugging is true, say &quot;-- after multiples movement rule: [list hand]&quot;.</font></blockquote>
<p>
<blockquote><font color="#000080"> Definition: a card is ace if its rank is 1.<br> Definition: a card is king if its rank is 13.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the royal-flush rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; if flushness is true and straightness is true and the highest card carried by the player is king and the lowest card carried by the player is ace, royal flush.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the straight-flushes rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; if flushness is true and straightness is true, straight flush.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the four-of-a-kind rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; if the quadruple count is 1, four of a kind.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the full-house rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; if the pair count is 1 and the triple count is 1, full house.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the flushes rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; if flushness is true, flush.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the straights rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; if straightness is true, straight.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the three-of-a-kind rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; if triple count is 1, three of a kind.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the two-pair rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; if the pair count is 2, two pairs.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the pair rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; if the pair count is 1, pair.</font></blockquote>
<p>
<blockquote><font color="#000080"> A hand-ranking rule (this is the default rule):<br>&nbsp;&nbsp;&nbsp;&nbsp; high card.</font></blockquote>
<p>
<blockquote><font color="#000080"> Sort-debugging is a truth state that varies.</font></blockquote>
<p>

<p>
<p></body></html>